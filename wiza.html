<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WIZA FOOD CAFE - Manager Dashboard</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <!-- Auto-redirect to specified URL -->

    <!-- Icons -->
    <link rel="icon" href="wfc.png" type="image/png">
    <link rel="apple-touch-icon" href="wfc.png">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    
    <style>
        :root {
            /* Dark Orange Color Scheme */
            --primary: #CC5500;
            --primary-light: #E67E22;
            --primary-dark: #A84300;
            --primary-extra-light: rgba(204, 85, 0, 0.1);
            
            /* Background Colors */
            --bg-primary: #1A1A1A;
            --bg-secondary: #2A2A2A;
            --bg-tertiary: #333333;
            --bg-card: #2A2A2A;
            --bg-hover: #3A3A3A;
            
            /* Text Colors */
            --text-primary: #FFFFFF;
            --text-secondary: #CCCCCC;
            --text-muted: #888888;
            --text-success: #34C759;
            --text-warning: #FF9500;
            --text-danger: #FF3B30;
            --text-info: #007AFF;
            
            /* Status Colors */
            --status-online: #34C759;
            --status-away: #FF9500;
            --status-busy: #FF3B30;
            --status-offline: #8E8E93;
            
            /* Functional Colors */
            --success: #34C759;
            --warning: #FF9500;
            --danger: #FF3B30;
            --info: #007AFF;
            
            /* UI Elements */
            --border-color: #555555;
            --border-light: rgba(85, 85, 85, 0.5);
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 4px 16px rgba(0, 0, 0, 0.4);
            --overlay: rgba(0, 0, 0, 0.7);
            
            /* Sizing & Spacing - Smaller values */
            --border-radius: 8px;
            --border-radius-sm: 6px;
            --border-radius-lg: 10px;
            --spacing-xs: 3px;
            --spacing-sm: 6px;
            --spacing-md: 9px;
            --spacing-lg: 12px;
            --spacing-xl: 15px;
            --spacing-xxl: 18px;
            
            /* Typography - Smaller font sizes */
            --font-size-xs: 10px;
            --font-size-sm: 12px;
            --font-size-md: 14px;
            --font-size-lg: 16px;
            --font-size-xl: 18px;
            --font-size-xxl: 20px;
            
            /* Transitions */
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.4s ease;
            
            /* Z-index layers */
            --z-dropdown: 1000;
            --z-sticky: 1020;
            --z-fixed: 1030;
            --z-modal-backdrop: 1040;
            --z-modal: 1050;
            --z-popover: 1060;
            --z-tooltip: 1070;
            --z-toast: 1080;
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 14px; /* Smaller base font size */
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.4; /* Tighter line height */
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 4px; /* Smaller scrollbar */
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 2px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        /* Selection Styling */
        ::-moz-selection {
            background-color: var(--primary-extra-light);
            color: var(--text-primary);
        }

        ::selection {
            background-color: var(--primary-extra-light);
            color: var(--text-primary);
        }

        /* Typography */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
            line-height: 1.2;
            margin-bottom: var(--spacing-md);
            color: var(--text-primary);
        }

        h1 { font-size: var(--font-size-xxl); }
        h2 { font-size: var(--font-size-xl); }
        h3 { font-size: var(--font-size-lg); }
        h4 { font-size: var(--font-size-md); }
        h5 { font-size: var(--font-size-sm); }
        h6 { font-size: var(--font-size-xs); }

        p {
            margin-bottom: var(--spacing-md);
            color: var(--text-secondary);
        }

        a {
            color: var(--primary);
            text-decoration: none;
            transition: color var(--transition-fast);
        }

        a:hover {
            color: var(--primary-light);
        }

        /* Layout Components */
        .manager-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 50px; /* Smaller header */
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            z-index: var(--z-fixed);
            display: flex;
            align-items: center;
            padding: 0 var(--spacing-lg);
            backdrop-filter: blur(10px);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .logo-img {
            width: 32px; /* Smaller logo */
            height: 32px;
            border-radius: 50%; /* Make logo round */
            object-fit: cover;
            border: 2px solid var(--primary);
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: var(--font-size-sm);
        }

        .logo-text {
            display: flex;
            flex-direction: column;
        }

        .logo-text h1 {
            font-size: var(--font-size-md);
            margin-bottom: 0;
            color: var(--text-primary);
        }

        .logo-text p {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
            margin-bottom: 0;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-xs) var(--spacing-md);
            background: var(--bg-tertiary);
            border-radius: var(--border-radius-lg);
            font-size: var(--font-size-xs);
            transition: all var(--transition-fast);
        }

        .connection-status.connected {
            background: rgba(52, 199, 89, 0.2);
            color: var(--success);
        }

        .connection-status.disconnected {
            background: rgba(255, 59, 48, 0.2);
            color: var(--danger);
        }

        .manager-info {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .manager-avatar {
            width: 30px; /* Smaller avatar */
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: white;
            font-size: var(--font-size-xs);
            border: 2px solid var(--primary-dark);
        }

        .logout-btn {
            background: var(--bg-tertiary);
            border: none;
            color: var(--text-secondary);
            padding: var(--spacing-xs) var(--spacing-md);
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-size: var(--font-size-xs);
            transition: all var(--transition-fast);
        }

        .logout-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        /* Navigation - 40% BIGGER */
        .manager-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 77px; /* 40% bigger (was 55px) */
            background: var(--bg-card);
            border-top: 1px solid var(--border-color);
            z-index: var(--z-fixed);
            display: flex;
            align-items: center;
            padding: 0 var(--spacing-sm);
            backdrop-filter: blur(10px);
        }

        .nav-container {
            display: flex;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            overflow-x: auto;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
        }

        .nav-container::-webkit-scrollbar {
            display: none; /* Chrome, Safari and Opera */
        }

        .nav-items {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: var(--spacing-md);
            padding: 0 var(--spacing-md);
            min-width: max-content;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-xs);
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: var(--font-size-sm); /* 40% bigger font */
            cursor: pointer;
            transition: all var(--transition-fast);
            border-radius: var(--border-radius);
            position: relative;
            min-width: 84px; /* 40% bigger (was 60px) */
            flex-shrink: 0;
        }

        .nav-item.active {
            color: var(--primary);
            background: var(--primary-extra-light);
        }

        .nav-item i {
            font-size: var(--font-size-lg); /* 40% bigger icons (was var(--font-size-md)) */
        }

        .notification-badge {
            position: absolute;
            top: 2px;
            right: 6px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 14px; /* Smaller badge */
            height: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-xs);
            font-weight: 600;
            border: 2px solid var(--bg-card);
        }

        /* Main Content */
        .manager-main {
            padding: 60px 0 77px; /* Smaller padding, accounting for bigger nav */
            max-width: 1400px;
            margin: 0 auto;
            min-height: 100vh;
        }

        .content-section {
            display: none;
            padding: var(--spacing-lg);
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--border-light);
        }

        .section-header h2 {
            margin-bottom: 0;
            color: var(--text-primary);
            font-weight: 600;
        }

        /* Search Bar */
        .search-container {
            margin-bottom: var(--spacing-xl);
        }

        .search-box {
            position: relative;
            display: flex;
            align-items: center;
            max-width: 400px; /* Smaller search box */
            margin: 0 auto;
        }

        .search-box input {
            padding: var(--spacing-sm) var(--spacing-sm) var(--spacing-sm) 36px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            width: 100%;
            font-size: var(--font-size-sm);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            transition: all var(--transition-fast);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px var(--primary-extra-light);
        }

        .search-box input::placeholder {
            color: var(--text-muted);
        }

        .search-box i {
            position: absolute;
            left: var(--spacing-sm);
            color: var(--text-muted);
            font-size: var(--font-size-sm);
        }

        /* Categories */
        .categories-container {
            margin-bottom: var(--spacing-xl);
            overflow-x: auto;
            white-space: nowrap;
            padding-bottom: var(--spacing-sm);
        }

        .categories-scroll {
            display: inline-flex;
            gap: var(--spacing-md);
        }

        .category-item {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--bg-tertiary);
            border-radius: var(--border-radius-lg);
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
            border: 1px solid transparent;
        }

        .category-item.active {
            background: var(--primary);
            color: white;
        }

        .category-item:hover:not(.active) {
            background: var(--bg-hover);
        }

        /* Menu Items Grid */
        .menu-items-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-lg);
        }

        .menu-item-card {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow);
            transition: all var(--transition-normal);
            position: relative;
        }

        .menu-item-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .menu-item-image {
            position: relative;
            height: 120px; /* Smaller image area */
            overflow: hidden;
            background: var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .menu-item-image i {
            font-size: 36px; /* Smaller icon */
            color: var(--text-muted);
        }

        .popular-badge, .new-badge {
            position: absolute;
            top: var(--spacing-sm);
            right: var(--spacing-sm);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius);
            font-size: var(--font-size-xs);
            font-weight: 600;
            color: white;
            z-index: 1;
        }

        .popular-badge {
            background: var(--primary);
        }

        .new-badge {
            background: var(--info);
        }

        .unavailable-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
            font-weight: 600;
            font-size: var(--font-size-md);
        }

        .menu-item-info {
            padding: var(--spacing-md);
        }

        .item-name {
            font-size: var(--font-size-sm);
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
            color: var(--text-primary);
        }

        .item-description {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-md);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .item-meta {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
            flex-wrap: wrap;
        }

        .item-category {
            background: var(--bg-tertiary);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius);
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
        }

        .vegetarian-badge {
            background: rgba(52, 199, 89, 0.2);
            color: var(--success);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius);
            font-size: var(--font-size-xs);
        }

        .item-pricing {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }

        .original-price {
            text-decoration: line-through;
            color: var(--text-muted);
            font-size: var(--font-size-xs);
        }

        .current-price {
            font-size: var(--font-size-md);
            font-weight: 700;
            color: var(--primary);
        }

        .discount-badge {
            background: var(--danger);
            color: white;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius);
            font-size: var(--font-size-xs);
            font-weight: 600;
        }

        .menu-item-actions {
            padding: 0 var(--spacing-md) var(--spacing-md);
            display: flex;
            gap: var(--spacing-sm);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-xs) var(--spacing-md);
            border: none;
            border-radius: var(--border-radius);
            font-size: var(--font-size-xs);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            text-decoration: none;
            white-space: nowrap;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--bg-hover);
            transform: translateY(-1px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background: #30B453;
            transform: translateY(-1px);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-warning:hover:not(:disabled) {
            background: #E68500;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background: #E6352B;
            transform: translateY(-1px);
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-info:hover:not(:disabled) {
            background: #006EE6;
            transform: translateY(-1px);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        .btn-outline:hover:not(:disabled) {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .btn-sm {
            padding: var(--spacing-xs) var(--spacing-sm);
            font-size: var(--font-size-xs);
        }

        .btn-lg {
            padding: var(--spacing-sm) var(--spacing-lg);
            font-size: var(--font-size-sm);
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow);
            transition: all var(--transition-normal);
            overflow: hidden;
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .card-header {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border-light);
            background: var(--bg-secondary);
        }

        .card-body {
            padding: var(--spacing-md);
        }

        .card-footer {
            padding: var(--spacing-md);
            border-top: 1px solid var(--border-light);
            background: var(--bg-secondary);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-md);
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow);
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .stat-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        .stat-icon {
            width: 40px; /* Smaller icon */
            height: 40px;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-md);
            color: white;
            background: var(--primary);
        }

        .stat-info {
            flex: 1;
        }

        .stat-title {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-xs);
        }

        .stat-value {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1;
        }

        .stat-change {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-size: var(--font-size-xs);
            margin-top: var(--spacing-sm);
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        /* Orders List */
        .orders-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .order-card {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-md);
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow);
            transition: all var(--transition-normal);
            position: relative;
            cursor: pointer;
        }

        .order-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
            border-radius: var(--border-radius-lg) 0 0 var(--border-radius-lg);
        }

        .order-card:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .order-card.priority {
            border-left: 4px solid var(--danger);
        }

        .order-card.new {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(204, 85, 0, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(204, 85, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(204, 85, 0, 0); }
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-md);
        }

        .order-info h4 {
            font-size: var(--font-size-md);
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
        }

        .order-customer, .order-time {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-xs);
        }

        .order-status-container {
            text-align: right;
        }

        .order-status {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius-lg);
            font-size: var(--font-size-xs);
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
        }

        .status-pending {
            background: rgba(204, 85, 0, 0.2);
            color: var(--warning);
            border: 1px solid rgba(204, 85, 0, 0.3);
        }

        .status-preparing {
            background: rgba(0, 122, 255, 0.2);
            color: var(--info);
            border: 1px solid rgba(0, 122, 255, 0.3);
        }

        .status-ready {
            background: rgba(52, 199, 89, 0.2);
            color: var(--success);
            border: 1px solid rgba(52, 199, 89, 0.3);
        }

        .status-out-for-delivery {
            background: rgba(88, 86, 214, 0.2);
            color: #5856D6;
            border: 1px solid rgba(88, 86, 214, 0.3);
        }

        .status-completed {
            background: rgba(142, 142, 147, 0.2);
            color: var(--text-muted);
            border: 1px solid rgba(142, 142, 147, 0.3);
        }

        .status-cancelled {
            background: rgba(255, 59, 48, 0.2);
            color: var(--danger);
            border: 1px solid rgba(255, 59, 48, 0.3);
        }

        .order-total-amount {
            font-size: var(--font-size-md);
            font-weight: 700;
            color: var(--primary);
        }

        .order-items-preview {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
            flex-wrap: wrap;
        }

        .order-item-preview {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            background: var(--bg-tertiary);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius-lg);
            font-size: var(--font-size-xs);
        }

        .item-preview-image {
            width: 20px; /* Smaller preview image */
            height: 20px;
            border-radius: 50%;
            object-fit: cover;
            background: var(--bg-secondary);
        }

        .more-items {
            background: var(--primary-extra-light);
            color: var(--primary);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius-lg);
            font-size: var(--font-size-xs);
        }

        .order-actions {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--overlay);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            padding: var(--spacing-lg);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
            backdrop-filter: blur(5px);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            width: 100%;
            max-width: 800px; /* Larger modal for order details */
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            transform: translateY(-20px) scale(0.95);
            transition: all var(--transition-normal);
            border: 1px solid var(--border-light);
        }

        .modal.active .modal-content {
            transform: translateY(0) scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border-light);
            background: var(--bg-secondary);
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .modal-header h3 {
            color: var(--text-primary);
            font-size: var(--font-size-md);
            margin-bottom: 0;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: var(--font-size-lg);
            color: var(--text-secondary);
            cursor: pointer;
            transition: color var(--transition-fast);
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius);
        }

        .close-modal:hover {
            color: var(--text-primary);
            background: var(--bg-tertiary);
        }

        .modal-body {
            padding: var(--spacing-md);
        }

        .modal-footer {
            padding: var(--spacing-md);
            border-top: 1px solid var(--border-light);
            background: var(--bg-secondary);
            display: flex;
            gap: var(--spacing-sm);
            justify-content: flex-end;
        }

        /* Enhanced Order Details Modal */
        .order-details-content {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }

        .order-detail-section {
            background: var(--bg-tertiary);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
        }

        .order-detail-section h4 {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
            color: var(--text-primary);
            font-size: var(--font-size-md);
        }

        .detail-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-sm);
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--border-light);
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-item.total {
            border-top: 2px solid var(--primary);
            font-weight: 700;
            font-size: var(--font-size-md);
        }

        .detail-item.discount {
            color: var(--success);
        }

        .order-items-detailed {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .order-item-detailed {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-sm);
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
        }

        .item-details h5 {
            margin-bottom: var(--spacing-xs);
            color: var(--text-primary);
        }

        .item-price {
            color: var(--text-secondary);
            font-size: var(--font-size-xs);
        }

        /* New Order Popup */
        .new-order-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-lg);
            z-index: var(--z-toast);
            max-width: 350px; /* Smaller popup */
            width: 90%;
            border: 2px solid var(--primary);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
        }

        .new-order-popup.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        .popup-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            color: var(--primary);
        }

        .popup-header i {
            font-size: var(--font-size-lg);
        }

        .popup-header h3 {
            font-size: var(--font-size-md);
            margin-bottom: 0;
        }

        .popup-content {
            margin-bottom: var(--spacing-md);
        }

        .popup-order-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-md);
        }

        .popup-order-id {
            font-weight: 600;
            color: var(--primary);
        }

        .popup-order-total {
            font-weight: 700;
            color: var(--text-primary);
        }

        .popup-customer {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-md);
        }

        .popup-items {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
        }

        .popup-actions {
            display: flex;
            gap: var(--spacing-md);
        }

        .popup-actions button {
            flex: 1;
            justify-content: center;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 60px;
            right: var(--spacing-lg);
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            padding: var(--spacing-md);
            max-width: 300px;
            z-index: var(--z-toast);
            transform: translateX(400px);
            transition: transform var(--transition-normal);
            border-left: 4px solid var(--primary);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification-success {
            border-left-color: var(--success);
        }

        .notification-error {
            border-left-color: var(--danger);
        }

        .notification-warning {
            border-left-color: var(--warning);
        }

        .notification-info {
            border-left-color: var(--info);
        }

        .notification-content {
            flex: 1;
        }

        .notification-content i {
            font-size: var(--font-size-md);
            margin-right: var(--spacing-sm);
        }

        .notification-success i {
            color: var(--success);
        }

        .notification-error i {
            color: var(--danger);
        }

        .notification-warning i {
            color: var(--warning);
        }

        .notification-info i {
            color: var(--info);
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: var(--spacing-xl) var(--spacing-lg);
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 36px; /* Smaller icon */
            margin-bottom: var(--spacing-md);
            color: var(--bg-tertiary);
        }

        .empty-state h3 {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-sm);
        }

        .empty-state p {
            margin-bottom: var(--spacing-md);
        }

        /* Form Elements */
        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--spacing-sm);
            font-weight: 500;
            color: var(--text-primary);
            font-size: var(--font-size-xs);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: var(--spacing-sm);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: var(--font-size-sm);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            transition: all var(--transition-fast);
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px var(--primary-extra-light);
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: var(--text-muted);
        }

        .form-row {
            display: flex;
            gap: var(--spacing-lg);
        }

        .form-row .form-group {
            flex: 1;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-weight: normal;
            cursor: pointer;
            font-size: var(--font-size-xs);
        }

        .form-actions {
            display: flex;
            gap: var(--spacing-md);
            margin-top: var(--spacing-xl);
        }

        /* Customer Table */
        .customers-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: var(--spacing-lg);
        }

        .customers-table th,
        .customers-table td {
            padding: var(--spacing-sm) var(--spacing-md);
            text-align: left;
            border-bottom: 1px solid var(--border-light);
        }

        .customers-table th {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-weight: 600;
            font-size: var(--font-size-sm);
        }

        .customers-table td {
            color: var(--text-secondary);
            font-size: var(--font-size-xs);
        }

        .customer-status {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius);
            font-size: var(--font-size-xs);
            font-weight: 500;
        }

        .status-active {
            background: rgba(52, 199, 89, 0.2);
            color: var(--success);
        }

        .status-inactive {
            background: rgba(142, 142, 147, 0.2);
            color: var(--text-muted);
        }

        /* Print Styles */
        @media print {
            .manager-header,
            .manager-nav,
            .btn,
            .notification,
            .new-order-popup,
            .modal-footer,
            .modal-header .close-modal {
                display: none !important;
            }
            
            .manager-main {
                padding: 0;
            }
            
            .content-section {
                display: block !important;
            }
            
            body {
                background: white;
                color: black;
            }
            
            .card, .stat-card, .order-card, .menu-item-card {
                border: 1px solid #000;
                box-shadow: none;
            }
            
            .modal {
                position: relative;
                background: white;
                padding: 0;
                display: block !important;
                opacity: 1;
                visibility: visible;
            }
            
            .modal-content {
                box-shadow: none;
                max-width: 100%;
                max-height: none;
                transform: none;
            }
            
            .order-details-content {
                color: black;
            }
            
            .order-detail-section {
                background: #f5f5f5;
            }
            
            .order-detail-section h4 {
                color: black;
            }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .manager-main {
                padding: 60px var(--spacing-lg) 77px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .manager-header {
                padding: 0 var(--spacing-md);
            }
            
            .header-actions {
                gap: var(--spacing-md);
            }
            
            .manager-nav {
                padding: 0 var(--spacing-xs);
                height: 70px; /* Adjusted for bigger nav */
            }
            
            .nav-item {
                min-width: 70px; /* Adjusted for bigger nav */
                padding: var(--spacing-xs);
                font-size: var(--font-size-xs);
            }
            
            .nav-item i {
                font-size: var(--font-size-md);
            }
            
            .manager-main {
                padding: 60px var(--spacing-md) 70px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .menu-items-grid {
                grid-template-columns: 1fr;
            }
            
            .section-header {
                flex-direction: column;
                gap: var(--spacing-md);
                align-items: flex-start;
            }
            
            .order-header {
                flex-direction: column;
                gap: var(--spacing-md);
            }
            
            .order-status-container {
                text-align: left;
                width: 100%;
            }
            
            .order-actions {
                flex-direction: column;
            }
            
            .order-actions button {
                width: 100%;
                justify-content: center;
            }
            
            .form-row {
                flex-direction: column;
                gap: var(--spacing-md);
            }
        }

        @media (max-width: 480px) {
            .manager-header {
                height: 45px;
            }
            
            .logo-text h1 {
                font-size: var(--font-size-sm);
            }
            
            .logo-text p {
                display: none;
            }
            
            .manager-nav {
                height: 63px; /* Adjusted for bigger nav */
            }
            
            .manager-main {
                padding: 55px var(--spacing-sm) 63px;
            }
            
            .content-section {
                padding: var(--spacing-md);
            }
            
            .modal {
                padding: var(--spacing-md);
            }
        }

        /* Additional styles for enhanced order details */
        .order-detail-section {
            background: var(--bg-tertiary);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }
        
        .order-detail-section h4 {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
            color: var(--text-primary);
            font-size: var(--font-size-md);
        }
        
        .detail-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-sm);
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--border-light);
        }
        
        .detail-item:last-child {
            border-bottom: none;
        }
        
        .detail-item.total {
            border-top: 2px solid var(--primary);
            font-weight: 700;
            font-size: var(--font-size-md);
        }
        
        .detail-item.discount {
            color: var(--success);
        }
        
        .order-items-detailed {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }
        
        .order-item-detailed {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-sm);
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
        }
        
        .item-details h5 {
            margin-bottom: var(--spacing-xs);
            color: var(--text-primary);
        }
        
        .item-price {
            color: var(--text-secondary);
            font-size: var(--font-size-xs);
        }
        
        .order-actions-footer {
            display: flex;
            gap: var(--spacing-md);
            justify-content: flex-end;
            margin-top: var(--spacing-lg);
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--border-light);
        }
        
        .customer-notes {
            background: var(--bg-secondary);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
            margin-top: var(--spacing-md);
            border-left: 3px solid var(--primary);
        }
        
        .notes-label {
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
            color: var(--text-primary);
        }
        
        .notes-content {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }
        
        .order-timeline {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-md);
        }
        
        .timeline-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }
        
        .timeline-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--text-muted);
            flex-shrink: 0;
        }
        
        .timeline-dot.active {
            background: var(--primary);
        }
        
        .timeline-content {
            flex: 1;
        }
        
        .timeline-time {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
        }
        
        .order-status-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius);
            font-size: var(--font-size-xs);
            font-weight: 600;
        }
        
        .status-badge-pending {
            background: rgba(204, 85, 0, 0.2);
            color: var(--warning);
            border: 1px solid rgba(204, 85, 0, 0.3);
        }
        
        .status-badge-accepted {
            background: rgba(0, 122, 255, 0.2);
            color: var(--info);
            border: 1px solid rgba(0, 122, 255, 0.3);
        }
        
        .status-badge-ready {
            background: rgba(52, 199, 89, 0.2);
            color: var(--success);
            border: 1px solid rgba(52, 199, 89, 0.3);
        }
        
        .status-badge-completed {
            background: rgba(142, 142, 147, 0.2);
            color: var(--text-muted);
            border: 1px solid rgba(142, 142, 147, 0.3);
        }
        
        .status-badge-cancelled {
            background: rgba(255, 59, 48, 0.2);
            color: var(--danger);
            border: 1px solid rgba(255, 59, 48, 0.3);
        }

        /* Map Container */
        .map-container {
            height: 200px;
            border-radius: var(--border-radius);
            overflow: hidden;
            margin-top: var(--spacing-md);
            border: 1px solid var(--border-color);
        }

        /* Item Customizations */
        .customization-list {
            margin-top: var(--spacing-sm);
            padding-left: var(--spacing-md);
        }

        .customization-item {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-xs);
        }

        /* Payment Screenshot */
        .payment-screenshot {
            max-width: 100%;
            border-radius: var(--border-radius);
            margin-top: var(--spacing-sm);
            border: 1px solid var(--border-color);
        }

        /* Promotions Grid */
        .promotions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--spacing-lg);
        }

        .promotion-card {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-md);
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow);
            transition: all var(--transition-normal);
        }

        .promotion-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .promotion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }

        .promotion-status {
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius);
            font-size: var(--font-size-xs);
            font-weight: 600;
        }

        .promotion-status.active {
            background: rgba(52, 199, 89, 0.2);
            color: var(--success);
        }

        .promotion-status.inactive {
            background: rgba(142, 142, 147, 0.2);
            color: var(--text-muted);
        }

        .promotion-description {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-md);
            font-size: var(--font-size-sm);
        }

        .promotion-details {
            display: flex;
            gap: var(--spacing-lg);
        }

        .promotion-details .detail {
            display: flex;
            flex-direction: column;
        }

        .promotion-details .label {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
            margin-bottom: var(--spacing-xs);
        }

        .promotion-details .value {
            font-size: var(--font-size-sm);
            color: var(--text-primary);
            font-weight: 600;
        }

        /* Analytics Charts */
        .analytics-charts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .chart-container {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-md);
            border: 1px solid var(--border-light);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }

        .chart-header h4 {
            margin-bottom: 0;
            color: var(--text-primary);
        }

        /* Settings Panel */
        .settings-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
        }

        .settings-section {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-md);
            border: 1px solid var(--border-light);
        }

        .settings-section h4 {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
            color: var(--text-primary);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--border-light);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-info {
            flex: 1;
        }

        .setting-title {
            font-size: var(--font-size-sm);
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
        }

        .setting-description {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-tertiary);
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }

        /* New Order Indicator */
        .new-order-indicator {
            position: fixed;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary);
            color: white;
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: var(--border-radius-lg);
            font-size: var(--font-size-sm);
            font-weight: 600;
            z-index: var(--z-toast);
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { transform: translateX(-50%) translateY(-20px); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }

        /* Navigation buttons for maps */
        .navigation-buttons {
            display: flex;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-md);
            justify-content: center;
        }

        .nav-btn {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius);
            font-size: var(--font-size-xs);
            font-weight: 600;
            text-decoration: none;
            transition: all var(--transition-fast);
        }

        .nav-btn.waze {
            background: #33CCFF;
            color: white;
        }

        .nav-btn.google {
            background: #4285F4;
            color: white;
        }

        .nav-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        /* Sound Notification Controls */
        .sound-controls {
            position: fixed;
            bottom: 90px;
            right: 20px;
            z-index: var(--z-fixed);
        }

        .sound-toggle {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all var(--transition-normal);
        }

        .sound-toggle:hover {
            transform: scale(1.1);
            background: var(--primary-dark);
        }

        .sound-toggle.muted {
            background: var(--text-muted);
        }
    </style>
</head>
<body>
    <!-- PWA Install Prompt -->
    <div class="pwa-install-prompt" id="pwaInstallPrompt">
        <span>Install WIZA FOOD CAFE Manager for better experience</span>
        <button id="installPWA" style="margin-left: 10px; background: white; color: var(--primary); border: none; padding: 5px 10px; border-radius: 4px;">Install</button>
        <button id="closePWA" style="margin-left: 5px; background: transparent; color: white; border: 1px solid white; padding: 5px 10px; border-radius: 4px;">Close</button>
    </div>
   <!-- Manager Header -->
    <header class="manager-header">
        <div class="header-content">
            <div class="logo">
                <img src="wfc.png" alt="WFC Logo" class="logo-img">
                <div class="logo-text">
                    <h1>WIZA FOOD CAFE</h1>
                    <p>Manager Dashboard</p>
                </div>
            </div>
            <div class="header-actions">
                <div class="connection-status" id="connectionStatus">
                    <i class="fas fa-wifi"></i>
                    <span>Connecting...</span>
                </div>
                <div class="manager-info">
                    <div class="manager-avatar">AM</div>
                    <button class="logout-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Sound Controls -->
    <div class="sound-controls">
        <button class="sound-toggle" id="soundToggle" title="Toggle notification sound">
            <i class="fas fa-volume-up"></i>
        </button>
    </div>


    <!-- New Order Popup -->
    <div class="new-order-popup" id="newOrderPopup">
        <div class="popup-header">
            <i class="fas fa-bell"></i>
            <h3>New Order Received!</h3>
        </div>
        <div class="popup-content">
            <div class="popup-order-info">
                <span class="popup-order-id" id="popupOrderId">Order #WIZA0001</span>
                <span class="popup-order-total" id="popupOrderTotal">K35.00</span>
            </div>
            <div class="popup-customer" id="popupCustomer">Customer: John Doe</div>
            <div class="popup-items" id="popupItems">1x Chicken & Chips, 2x Sausage & Chips</div>
        </div>
        <div class="popup-actions">
            <button class="btn btn-secondary" id="closePopupBtn">Close</button>
            <button class="btn btn-primary" id="viewOrderBtn">View Order</button>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div class="notification-content">
            <i class="fas fa-check-circle"></i>
            <span id="notificationMessage">Operation completed successfully</span>
        </div>
    </div>

    <!-- Main Content -->
    <main class="manager-main">
        <!-- Dashboard Section -->
        <section class="content-section active" id="dashboard">
            <div class="section-header">
                <h2>Dashboard Overview</h2>
                <div class="header-actions">
                    <select id="timeRange" class="form-group" style="background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: var(--spacing-sm); font-size: var(--font-size-sm);">
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                    </select>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-title">Total Revenue</div>
                            <div class="stat-value" id="totalRevenue">K0.00</div>
                        </div>
                    </div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0% from yesterday</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-title">Total Orders</div>
                            <div class="stat-value" id="totalOrders">0</div>
                        </div>
                    </div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0% from yesterday</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-title">Active Customers</div>
                            <div class="stat-value" id="activeCustomers">0</div>
                        </div>
                    </div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0% from yesterday</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-title">Pending Orders</div>
                            <div class="stat-value" id="pendingOrders">0</div>
                        </div>
                    </div>
                    <div class="stat-change">
                        <span>Ready: <span id="readyOrders">0</span></span>
                    </div>
                </div>
            </div>

            <!-- Recent Orders -->
            <div class="section-header">
                <h2>Recent Orders</h2>
                <button class="btn btn-primary" onclick="navigateToSection('orders')">
                    View All
                </button>
            </div>

            <div class="orders-list" id="recentOrdersList">
                <div class="empty-state">
                    <i class="fas fa-shopping-cart"></i>
                    <h3>No Recent Orders</h3>
                    <p>New orders will appear here</p>
                </div>
            </div>
        </section>

        <!-- Menu Management Section -->
        <section class="content-section" id="menu-management">
            <div class="section-header">
                <h2>Menu Management</h2>
                <div class="header-actions">
                    <button class="btn btn-primary" id="addMenuItemBtn">
                        <i class="fas fa-plus"></i> Add Item
                    </button>
                </div>
            </div>

            <!-- Search Bar -->
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="menuSearch" placeholder="Search menu...">
                    <i class="fas fa-search"></i>
                </div>
            </div>

            <!-- Categories -->
            <div class="categories-container">
                <div class="categories-scroll">
                    <div class="category-item active" data-category="all">All</div>
                    <div class="category-item" data-category="quick-fills">Quick Fills</div>
                    <div class="category-item" data-category="savory-bites">Savory Bites</div>
                    <div class="category-item" data-category="snacks-treats">Snacks & Treats</div>
                    <div class="category-item" data-category="beverages">Beverages</div>
                </div>
            </div>

            <!-- Menu Items Grid -->
            <div id="menuItemsGrid" class="menu-items-grid">
                <div class="empty-state">
                    <i class="fas fa-utensils"></i>
                    <h3>No Menu Items</h3>
                    <p>Add your first menu item to get started</p>
                </div>
            </div>
        </section>

        <!-- Orders Section -->
        <section class="content-section" id="orders">
            <div class="section-header">
                <h2>Order Management</h2>
                <div class="header-actions">
                    <div class="search-box">
                        <input type="text" id="orderSearch" placeholder="Search orders...">
                        <i class="fas fa-search"></i>
                    </div>
                </div>
            </div>

            <!-- Orders List -->
            <div class="orders-list" id="ordersList">
                <div class="empty-state">
                    <i class="fas fa-shopping-cart"></i>
                    <h3>No Orders</h3>
                    <p>Customer orders will appear here</p>
                </div>
            </div>
        </section>

        <!-- Promotions Section -->
        <section class="content-section" id="promotions">
            <div class="section-header">
                <h2>Promotions</h2>
                <button class="btn btn-primary" id="addPromotionBtn">
                    <i class="fas fa-plus"></i> Add Promotion
                </button>
            </div>

            <!-- Promotions Grid -->
            <div class="promotions-grid" id="promotionsGrid">
                <div class="empty-state">
                    <i class="fas fa-tag"></i>
                    <h3>No Promotions</h3>
                    <p>Create promotions to attract more customers</p>
                </div>
            </div>
        </section>

        <!-- Customers Section -->
        <section class="content-section" id="customers">
            <div class="section-header">
                <h2>Customer Management</h2>
                <div class="header-actions">
                    <div class="search-box">
                        <input type="text" id="customerSearch" placeholder="Search customers...">
                        <i class="fas fa-search"></i>
                    </div>
                </div>
            </div>

            <!-- Customers Table -->
            <div class="customers-table-container">
                <table class="customers-table" id="customersTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Phone</th>
                            <th>Email</th>
                            <th>Orders</th>
                            <th>Total Spent</th>
                            <th>Last Order</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="customersTableBody">
                        <!-- Customers will be populated here -->
                    </tbody>
                </table>
                <div class="empty-state" id="customersEmptyState">
                    <i class="fas fa-users"></i>
                    <h3>No Customers</h3>
                    <p>Customer data will appear here</p>
                </div>
            </div>
        </section>

        <!-- Analytics Section -->
        <section class="content-section" id="analytics">
            <div class="section-header">
                <h2>Analytics</h2>
                <div class="header-actions">
                    <select id="analyticsPeriod" class="form-group" style="background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: var(--spacing-sm); font-size: var(--font-size-sm);">
                        <option value="7">Last 7 Days</option>
                        <option value="30">Last 30 Days</option>
                        <option value="90">Last 90 Days</option>
                    </select>
                </div>
            </div>

            <div class="analytics-charts">
                <div class="chart-container">
                    <div class="chart-header">
                        <h4>Revenue Trend</h4>
                    </div>
                    <canvas id="revenueChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-header">
                        <h4>Order Volume</h4>
                    </div>
                    <canvas id="ordersChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-header">
                        <h4>Popular Items</h4>
                    </div>
                    <canvas id="itemsChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-header">
                        <h4>Customer Activity</h4>
                    </div>
                    <canvas id="customersChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section class="content-section" id="settings">
            <div class="section-header">
                <h2>Settings</h2>
                <button class="btn btn-primary" id="saveSettings">
                    <i class="fas fa-save"></i> Save Settings
                </button>
            </div>

            <div class="settings-panel">
                <div class="settings-section">
                    <h4><i class="fas fa-bell"></i> Notifications</h4>
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">New Order Alerts</div>
                            <div class="setting-description">Play sound when new orders arrive</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="notificationSound" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Order Status Updates</div>
                            <div class="setting-description">Notify when order status changes</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="statusNotifications" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Low Stock Alerts</div>
                            <div class="setting-description">Alert when items are running low</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="stockAlerts" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <h4><i class="fas fa-store"></i> Restaurant Settings</h4>
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Accept New Orders</div>
                            <div class="setting-description">Allow new orders to come in</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="acceptOrders" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Delivery Service</div>
                            <div class="setting-description">Enable delivery orders</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="deliveryEnabled" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Auto Order Refresh</div>
                            <div class="setting-description">Automatically refresh orders list</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoRefresh" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <h4><i class="fas fa-receipt"></i> Order Settings</h4>
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Default Preparation Time</div>
                            <div class="setting-description">Standard time to prepare orders</div>
                        </div>
                        <select id="preparationTime" style="background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: var(--spacing-sm); font-size: var(--font-size-sm);">
                            <option value="15">15 minutes</option>
                            <option value="20">20 minutes</option>
                            <option value="25" selected>25 minutes</option>
                            <option value="30">30 minutes</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Auto-Accept Orders</div>
                            <div class="setting-description">Automatically accept new orders</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoAcceptOrders">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Print Receipts</div>
                            <div class="setting-description">Auto-print order receipts</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoPrint">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <h4><i class="fas fa-chart-line"></i> Analytics Settings</h4>
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Daily Reports</div>
                            <div class="setting-description">Generate daily sales reports</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="dailyReports" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Customer Insights</div>
                            <div class="setting-description">Track customer behavior</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="customerInsights" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Inventory Tracking</div>
                            <div class="setting-description">Monitor stock levels</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="inventoryTracking">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Manager Navigation - 40% BIGGER -->
    <nav class="manager-nav">
        <div class="nav-container">
            <div class="nav-items">
                <button class="nav-item active" data-section="dashboard">
                    <i class="fas fa-chart-pie"></i>
                    <span>Dashboard</span>
                </button>
                <button class="nav-item" data-section="menu-management">
                    <i class="fas fa-utensils"></i>
                    <span>Menu</span>
                </button>
                <button class="nav-item" data-section="orders">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Orders</span>
                    <span class="notification-badge" id="pendingOrdersCount">0</span>
                </button>
                <button class="nav-item" data-section="promotions">
                    <i class="fas fa-tag"></i>
                    <span>Promotions</span>
                </button>
                <button class="nav-item" data-section="customers">
                    <i class="fas fa-users"></i>
                    <span>Customers</span>
                </button>
                <button class="nav-item" data-section="analytics">
                    <i class="fas fa-chart-bar"></i>
                    <span>Analytics</span>
                </button>
                <button class="nav-item" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Enhanced Order Details Modal -->
    <div class="modal" id="orderDetailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Order Details</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="order-details-content" id="orderDetailsContent">
                    <!-- Order details will be populated here -->
                </div>
                <div class="order-actions-footer">
                    <button class="btn btn-secondary close-modal">Close</button>
                    <button class="btn btn-primary" id="printOrderBtn">Print</button>
                    <button class="btn btn-success" id="acceptOrderBtn">Accept Order</button>
                    <button class="btn btn-danger" id="rejectOrderBtn">Reject Order</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Menu Item Modal -->
    <div class="modal" id="menuItemModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Menu Item</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="menuItemForm">
                    <div class="form-group">
                        <label for="itemName">Item Name</label>
                        <input type="text" id="itemName" required placeholder="Enter item name">
                    </div>
                    <div class="form-group">
                        <label for="itemDescription">Description</label>
                        <textarea id="itemDescription" required placeholder="Enter item description"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="itemPrice">Price (K)</label>
                            <input type="number" id="itemPrice" step="0.01" min="0" required placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label for="itemCategory">Category</label>
                            <select id="itemCategory" required>
                                <option value="quick-fills">Quick Fills</option>
                                <option value="savory-bites">Savory Bites</option>
                                <option value="snacks-treats">Snacks & Treats</option>
                                <option value="beverages">Beverages</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Save Item</button>
                        <button type="button" class="btn btn-secondary close-modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Promotion Modal -->
    <div class="modal" id="promotionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Promotion</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="promotionForm">
                    <div class="form-group">
                        <label for="promotionTitle">Promotion Title</label>
                        <input type="text" id="promotionTitle" required placeholder="Enter promotion title">
                    </div>
                    <div class="form-group">
                        <label for="promotionDescription">Description</label>
                        <textarea id="promotionDescription" required placeholder="Enter promotion description"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="promotionCode">Promo Code</label>
                            <input type="text" id="promotionCode" required placeholder="e.g., WIZA20">
                        </div>
                        <div class="form-group">
                            <label for="promotionDiscount">Discount (%)</label>
                            <input type="number" id="promotionDiscount" min="1" max="100" required placeholder="10">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="promotionStart">Start Date</label>
                            <input type="datetime-local" id="promotionStart" required>
                        </div>
                        <div class="form-group">
                            <label for="promotionEnd">End Date</label>
                            <input type="datetime-local" id="promotionEnd" required>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Create Promotion</button>
                        <button type="button" class="btn btn-secondary close-modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Firebase Configuration
// Enhanced Firebase Configuration
const firebaseConfig = {
    apiKey: "BEHA9PJkJV_r7A5zDGXApm9LnO3N0XccM7nukrKgDTNCNKyFEn0bzAlhve4SwR6i3XX1jl-5acCeHEVAWkyT2t4",
    authDomain: "wizafoodcafe.firebaseapp.com",
    databaseURL: "https://wizafoodcafe-default-rtdb.firebaseio.com",
    projectId: "wizafoodcafe",
    storageBucket: "wizafoodcafe.firebasestorage.app",
    messagingSenderId: "248334218737",
    appId: "1:248334218737:web:94fabd0bbdf75bb8410050"
};;

// Initialize Firebase
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const storage = firebase.storage();

// Restaurant location
const restaurantLocation = [-15.402235977316481, 28.329942522202668];

// Enhanced Manager App State
const managerState = {
    currentSection: 'dashboard',
    menuItems: [],
    orders: [],
    customers: [],
    promotions: [],
    analytics: {},
    settings: {
        appOnline: true,
        acceptOrders: true,
        deliveryEnabled: true,
        notificationSound: true,
        autoRefresh: true,
        statusNotifications: true,
        stockAlerts: true,
        autoAcceptOrders: false,
        autoPrint: false,
        dailyReports: true,
        customerInsights: true,
        inventoryTracking: false,
        preparationTime: 25
    },
    restaurantLocation: restaurantLocation,
    orderCounter: 1,
    currentNewOrder: null,
    notificationSound: null,
    notificationInterval: null,
    processedOrderIds: new Set(),
    currentOrderInModal: null,
    soundEnabled: true,
    isOnline: true,
    deferredPrompt: null,
    serviceWorkerRegistration: null
};

// DOM Elements
let elements = {};

// Initialize Enhanced Manager App
// Add this to your initializeManagerApp function
async function initializeManagerApp() {
    console.log(' Initializing Enhanced Manager App...');
    
    // Initialize PWA
    initializePWA();
    
    // Check if we need to redirect
    const currentUrl = window.location.href;
    const targetUrl = 'https://bufferzone-cloud.github.io/wizamanager/home.html';
    
    if (!currentUrl.includes('wizamanager/home.html')) {
        console.log(' Redirecting to manager home page...');
        window.location.href = targetUrl;
        return; // Stop execution since we're redirecting
    }
    
    // Initialize PWA
    initializePWA();
    
    // Register Service Worker
    await registerServiceWorker();
    
    // Request Notification Permission
    await requestNotificationPermission();
    
    // Initialize the rest of your app
    initializeElements();
    setupEventListeners();
    loadManagerData();
    setupEnhancedFirebaseListeners(); // Use enhanced listeners
    
    // Initialize sections
    updateDashboard();
    loadFullMenu();
    loadOrders();
    loadCustomers();
    loadPromotions();
    initializeAnalytics();
    loadSettings();
    
    // Start auto-refresh for orders
    startAutoRefresh();
    
    showNotification('Enhanced Manager dashboard loaded with real-time order tracking!', 'success');
}

// Service Worker Registration
async function registerServiceWorker() {
    if ('serviceWorker' in navigator) {
        try {
            const registration = await navigator.serviceWorker.register('sw-manager.js');
            console.log(' Service Worker registered:', registration);
            managerState.serviceWorkerRegistration = registration;
            
            // Set up periodic sync for notifications
            if ('periodicSync' in registration) {
                try {
                    await registration.periodicSync.register('order-check', {
                        minInterval: 60 * 1000 // 1 minute
                    });
                    console.log(' Periodic sync registered');
                } catch (error) {
                    console.log(' Periodic sync not supported:', error);
                }
            }
            
            return registration;
        } catch (error) {
            console.error(' Service Worker registration failed:', error);
        }
    }
    return null;
}

// Request Notification Permission
async function requestNotificationPermission() {
    if (!('Notification' in window)) {
        console.log(' This browser does not support notifications');
        return false;
    }
    
    if (Notification.permission === 'granted') {
        console.log(' Notifications already granted');
        return true;
    }
    
    if (Notification.permission === 'denied') {
        console.log(' Notifications denied by user');
        return false;
    }
    
    const permission = await Notification.requestPermission();
    if (permission === 'granted') {
        console.log(' Notifications permission granted');
        return true;
    }
    
    console.log(' Notifications permission denied');
    return false;
}

// PWA Installation
// Enhanced PWA Installation Handler for Manager App
function initializePWA() {
    let deferredPrompt;
    const installPrompt = document.getElementById('pwaInstallPrompt');
    
    // Listen for beforeinstallprompt event
    window.addEventListener('beforeinstallprompt', (e) => {
        console.log(' PWA install prompt triggered in manager');
        e.preventDefault();
        deferredPrompt = e;
        
        // Show install prompt in the middle of the screen
        setTimeout(() => {
            if (!isAppInstalled()) {
                showInstallPrompt();
            }
        }, 3000); // Show after 3 seconds
    });

    // Install button handler
    document.getElementById('installPWA')?.addEventListener('click', async () => {
        if (!deferredPrompt) return;
        
        console.log(' Installing PWA from manager...');
        deferredPrompt.prompt();
        
        const { outcome } = await deferredPrompt.userChoice;
        console.log(`User response: ${outcome}`);
        
        if (outcome === 'accepted') {
            console.log(' PWA installed successfully from manager');
            hideInstallPrompt();
            
            // Show success message
            showNotification('App installed successfully!', 'success');
        }
        
        deferredPrompt = null;
    });

    // Close button handler
    document.getElementById('closePWA')?.addEventListener('click', () => {
        console.log(' PWA install cancelled from manager');
        hideInstallPrompt();
    });

    // Listen for app installation
    window.addEventListener('appinstalled', (evt) => {
        console.log(' WIZA Manager was successfully installed');
        hideInstallPrompt();
        
        // Update UI to reflect installed state
        updateAppInstalledUI();
    });
}

// Show install prompt in the middle of the screen
function showInstallPrompt() {
    const prompt = document.getElementById('pwaInstallPrompt');
    if (prompt) {
        prompt.style.display = 'block';
        prompt.style.position = 'fixed';
        prompt.style.top = '50%';
        prompt.style.left = '50%';
        prompt.style.transform = 'translate(-50%, -50%)';
        prompt.style.zIndex = '10000';
        prompt.style.background = 'var(--bg-card)';
        prompt.style.border = '2px solid var(--primary)';
        prompt.style.borderRadius = 'var(--border-radius-lg)';
        prompt.style.padding = 'var(--spacing-lg)';
        prompt.style.boxShadow = 'var(--shadow-lg)';
        prompt.style.textAlign = 'center';
        prompt.style.maxWidth = '90%';
        prompt.style.width = '300px';
    }
}

// Hide install prompt
function hideInstallPrompt() {
    const prompt = document.getElementById('pwaInstallPrompt');
    if (prompt) {
        prompt.style.display = 'none';
    }
}

// Check if app is already installed
function isAppInstalled() {
    return window.matchMedia('(display-mode: standalone)').matches || 
           window.navigator.standalone === true;
}

// Update UI when app is installed
function updateAppInstalledUI() {
    // You can update the UI to show installed state
    console.log(' App is installed, updating UI...');
}
// Test Notifications
function setupTestNotifications() {
    document.getElementById('testNotification')?.addEventListener('click', () => {
        const testOrder = {
            firebaseKey: 'test-' + Date.now(),
            ref: 'WIZATEST',
            customer: { name: 'Test Customer', phone: '0970000000' },
            total: 45.00,
            items: [{ name: 'Test Item', quantity: 1, price: 45 }],
            customerLocation: {
                address: 'Test Address, Lusaka',
                coordinates: [-15.4001909, 28.3026508]
            }
        };
        
        showNewOrderNotification(testOrder);
        showNotification('Test notification triggered!', 'success');
    });
}

// Initialize DOM elements
function initializeElements() {
    elements = {
        // Navigation
        navItems: document.querySelectorAll('.nav-item'),
        logoutBtn: document.getElementById('logoutBtn'),
        
        // Dashboard
        totalRevenue: document.getElementById('totalRevenue'),
        totalOrders: document.getElementById('totalOrders'),
        activeCustomers: document.getElementById('activeCustomers'),
        pendingOrders: document.getElementById('pendingOrders'),
        readyOrders: document.getElementById('readyOrders'),
        pendingOrdersCount: document.getElementById('pendingOrdersCount'),
        
        // Orders
        ordersList: document.getElementById('ordersList'),
        orderSearch: document.getElementById('orderSearch'),
        recentOrdersList: document.getElementById('recentOrdersList'),
        
        // Menu Management
        menuItemsGrid: document.getElementById('menuItemsGrid'),
        menuSearch: document.getElementById('menuSearch'),
        addMenuItemBtn: document.getElementById('addMenuItemBtn'),
        categoryItems: document.querySelectorAll('.category-item'),
        
        // Promotions
        promotionsGrid: document.getElementById('promotionsGrid'),
        addPromotionBtn: document.getElementById('addPromotionBtn'),
        
        // Customers
        customerSearch: document.getElementById('customerSearch'),
        customersTableBody: document.getElementById('customersTableBody'),
        customersEmptyState: document.getElementById('customersEmptyState'),
        
        // Analytics
        revenueChart: document.getElementById('revenueChart'),
        ordersChart: document.getElementById('ordersChart'),
        itemsChart: document.getElementById('itemsChart'),
        customersChart: document.getElementById('customersChart'),
        
        // Settings
        saveSettings: document.getElementById('saveSettings'),
        notificationSound: document.getElementById('notificationSound'),
        statusNotifications: document.getElementById('statusNotifications'),
        stockAlerts: document.getElementById('stockAlerts'),
        acceptOrders: document.getElementById('acceptOrders'),
        deliveryEnabled: document.getElementById('deliveryEnabled'),
        autoRefresh: document.getElementById('autoRefresh'),
        preparationTime: document.getElementById('preparationTime'),
        autoAcceptOrders: document.getElementById('autoAcceptOrders'),
        autoPrint: document.getElementById('autoPrint'),
        dailyReports: document.getElementById('dailyReports'),
        customerInsights: document.getElementById('customerInsights'),
        inventoryTracking: document.getElementById('inventoryTracking'),
        
        // Modals
        modals: document.querySelectorAll('.modal'),
        closeModalBtns: document.querySelectorAll('.close-modal'),
        orderDetailsModal: document.getElementById('orderDetailsModal'),
        menuItemModal: document.getElementById('menuItemModal'),
        promotionModal: document.getElementById('promotionModal'),
        newOrderPopup: document.getElementById('newOrderPopup'),
        notification: document.getElementById('notification'),
        
        // Order Details
        orderDetailsContent: document.getElementById('orderDetailsContent'),
        
        // Print Button
        printOrderBtn: document.getElementById('printOrderBtn'),
        acceptOrderBtn: document.getElementById('acceptOrderBtn'),
        rejectOrderBtn: document.getElementById('rejectOrderBtn'),
        
        // Forms
        menuItemForm: document.getElementById('menuItemForm'),
        promotionForm: document.getElementById('promotionForm'),
        
        // Sound Controls
        soundToggle: document.getElementById('soundToggle'),
        
        // Test Notification Button
        testNotification: document.getElementById('testNotification')
    };
}

// Setup event listeners
function setupEventListeners() {
    // Navigation
    elements.navItems.forEach(item => {
        item.addEventListener('click', () => navigateToSection(item.dataset.section));
    });

    // Logout
    if (elements.logoutBtn) {
        elements.logoutBtn.addEventListener('click', logout);
    }

    // Order management
    if (elements.orderSearch) {
        elements.orderSearch.addEventListener('input', debounce(filterOrders, 300));
    }

    // Menu management
    if (elements.addMenuItemBtn) {
        elements.addMenuItemBtn.addEventListener('click', () => showModal(elements.menuItemModal));
    }
    
    if (elements.menuSearch) {
        elements.menuSearch.addEventListener('input', debounce(searchMenuItems, 300));
    }

    // Categories
    if (elements.categoryItems) {
        elements.categoryItems.forEach(item => {
            item.addEventListener('click', () => {
                // Remove active class from all categories
                elements.categoryItems.forEach(cat => cat.classList.remove('active'));
                // Add active class to clicked category
                item.classList.add('active');
                // Filter menu by category
                loadFullMenu(item.dataset.category);
            });
        });
    }

    // Promotions
    if (elements.addPromotionBtn) {
        elements.addPromotionBtn.addEventListener('click', () => showModal(elements.promotionModal));
    }

    // Customers
    if (elements.customerSearch) {
        elements.customerSearch.addEventListener('input', debounce(searchCustomers, 300));
    }

    // Settings
    if (elements.saveSettings) {
        elements.saveSettings.addEventListener('click', saveSettings);
    }

    // Forms
    if (elements.menuItemForm) {
        elements.menuItemForm.addEventListener('submit', handleAddMenuItem);
    }

    if (elements.promotionForm) {
        elements.promotionForm.addEventListener('submit', handleAddPromotion);
    }

    // Modals
    elements.closeModalBtns.forEach(btn => {
        btn.addEventListener('click', closeAllModals);
    });

    // New order popup
    document.getElementById('closePopupBtn').addEventListener('click', () => {
        hideModal(elements.newOrderPopup);
        stopNotificationSound();
    });

    document.getElementById('viewOrderBtn').addEventListener('click', () => {
        if (managerState.currentNewOrder) {
            viewOrderDetails(managerState.currentNewOrder.firebaseKey);
            hideModal(elements.newOrderPopup);
            stopNotificationSound();
        }
    });

    // Print order button
    if (elements.printOrderBtn) {
        elements.printOrderBtn.addEventListener('click', printOrderDetails);
    }

    // Accept order button
    if (elements.acceptOrderBtn) {
        elements.acceptOrderBtn.addEventListener('click', acceptCurrentOrder);
    }

    // Reject order button
    if (elements.rejectOrderBtn) {
        elements.rejectOrderBtn.addEventListener('click', rejectCurrentOrder);
    }

    // Sound toggle
    if (elements.soundToggle) {
        elements.soundToggle.addEventListener('click', toggleSound);
    }

    // Test notification button
    if (elements.testNotification) {
        elements.testNotification.addEventListener('click', () => {
            const testOrder = {
                firebaseKey: 'test-' + Date.now(),
                ref: 'WIZATEST',
                customer: { name: 'Test Customer', phone: '0970000000' },
                total: 45.00,
                items: [{ name: 'Test Item', quantity: 1, price: 45 }],
                customerLocation: {
                    address: 'Test Address, Lusaka',
                    coordinates: [-15.4001909, 28.3026508]
                }
            };
            
            showNewOrderNotification(testOrder);
            showNotification('Test notification triggered!', 'success');
        });
    }

    // Event delegation for dynamic elements
    document.addEventListener('click', function(e) {
        // View order details
        if (e.target.closest('.view-order-btn') || e.target.closest('.order-card')) {
            const button = e.target.closest('.view-order-btn') || e.target.closest('.order-card');
            const orderId = button.dataset.id;
            viewOrderDetails(orderId);
        }
        
        // Update order status
        if (e.target.closest('.status-btn')) {
            const button = e.target.closest('.status-btn');
            const orderId = button.dataset.id;
            const status = button.dataset.status;
            updateOrderStatus(orderId, status);
        }
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeAllModals();
            stopNotificationSound();
        }
    });
}

// Enhanced Firebase Real-time Listeners
// Enhanced Firebase Real-time Listeners with Sound and Notifications
function setupEnhancedFirebaseListeners() {
    console.log(" Setting up enhanced Firebase real-time listeners...");
    
    // Listen for new orders with improved error handling
    const ordersRef = db.ref("orders");
    
    ordersRef.on('child_added', (snapshot) => {
        try {
            const newOrder = snapshot.val();
            const orderKey = snapshot.key;
            
            console.log(" New order received from Firebase:", newOrder);
            
            if (!newOrder) {
                console.warn(" Received null order data");
                return;
            }
            
            // Check if we've already processed this order
            if (!managerState.processedOrderIds.has(orderKey)) {
                // Mark this order as processed
                managerState.processedOrderIds.add(orderKey);
                
                // Add Firebase key to order
                newOrder.firebaseKey = orderKey;
                newOrder.id = newOrder.orderId || generateId();
                
                // Process the new order
                processNewOrder(newOrder);
                
                // Show enhanced new order notification to manager
                if (managerState.settings.acceptOrders) {
                    showEnhancedNewOrderNotification(newOrder);
                }
            } else {
                console.log(" Order already processed:", orderKey);
            }
        } catch (error) {
            console.error(" Error processing new order:", error);
        }
    }, (error) => {
        console.error(" Firebase listener error:", error);
    });

    // Listen for order updates
    ordersRef.on('child_changed', (snapshot) => {
        try {
            const updatedOrder = snapshot.val();
            const orderKey = snapshot.key;
            
            if (!updatedOrder) return;
            
            updatedOrder.firebaseKey = orderKey;
            updatedOrder.id = updatedOrder.orderId || orderKey;
            
            console.log(" Order updated:", updatedOrder);
            
            // Update the order in the manager state
            updateExistingOrder(updatedOrder);
            
            // Show notification for status changes
            if (updatedOrder.status && updatedOrder.status !== 'pending') {
                showStatusUpdateNotification(updatedOrder);
            }
        } catch (error) {
            console.error(" Error processing order update:", error);
        }
    });

    // Enhanced connection monitoring
    const connectedRef = db.ref(".info/connected");
    connectedRef.on("value", (snap) => {
        managerState.isOnline = snap.val() === true;
        updateConnectionStatus(managerState.isOnline);
        
        if (managerState.isOnline) {
            console.log(" Firebase Realtime Database connected");
            showNotification('Connected to server - Receiving real-time orders', 'success');
        } else {
            console.log(" Firebase Realtime Database disconnected");
            showNotification('Offline - working locally', 'warning');
        }
    });
}

// Enhanced Coordinate Handling
function formatCoordinates(order) {
    if (!order.customerLocation) {
        return '<div class="coordinates-display error">No location data</div>';
    }

    let coordinates = order.customerLocation.coordinates;
    let address = order.customerLocation.address || 'Unknown address';
    
    // Handle different coordinate formats
    if (Array.isArray(coordinates)) {
        // Format: [lat, lng]
        const [lat, lng] = coordinates;
        return `
            <div class="coordinates-display success">
                <strong>Coordinates:</strong> ${lat.toFixed(6)}, ${lng.toFixed(6)}<br>
                <strong>Address:</strong> ${address}
            </div>
        `;
    } else if (coordinates && typeof coordinates === 'object') {
        // Format: { latitude: x, longitude: y }
        const lat = coordinates.latitude || coordinates.lat;
        const lng = coordinates.longitude || coordinates.lng || coordinates.lon;
        
        if (lat && lng) {
            return `
                <div class="coordinates-display success">
                    <strong>Coordinates:</strong> ${parseFloat(lat).toFixed(6)}, ${parseFloat(lng).toFixed(6)}<br>
                    <strong>Address:</strong> ${address}
                </div>
            `;
        }
    }
    
    return '<div class="coordinates-display error">Invalid coordinate format</div>';
}

// Process new order from Firebase
function processNewOrder(order) {
    try {
        // Enhanced coordinate validation
        const enhancedOrder = validateAndEnhanceOrder(order);
        
        // Check if order already exists (by ID or firebase key)
        const existingOrderIndex = managerState.orders.findIndex(o => 
            o.id === enhancedOrder.id || o.firebaseKey === enhancedOrder.firebaseKey
        );
        
        if (existingOrderIndex === -1) {
            // Add to orders array at the beginning
            managerState.orders.unshift(enhancedOrder);
            
            // Update order counter
            if (enhancedOrder.id && enhancedOrder.id >= managerState.orderCounter) {
                managerState.orderCounter = enhancedOrder.id + 1;
            }
            
            // Save data immediately
            saveManagerData();
            
            // Update UI in real-time
            updateUIForNewOrder(enhancedOrder);
            
            console.log(' New order processed successfully:', enhancedOrder.ref);
        } else {
            console.log(' Order already exists, updating:', enhancedOrder.ref);
            // Update existing order
            managerState.orders[existingOrderIndex] = {
                ...managerState.orders[existingOrderIndex],
                ...enhancedOrder
            };
            
            saveManagerData();
            updateUIForOrderUpdate(enhancedOrder);
        }
    } catch (error) {
        console.error(' Error processing new order:', error);
    }
}

// Enhanced Order Validation
function validateAndEnhanceOrder(order) {
    const now = new Date().toISOString();
    
    // Enhanced coordinate handling
    let customerLocation = null;
    if (order.customerLocation) {
        customerLocation = {
            address: order.customerLocation.address || "Address not provided",
            coordinates: normalizeCoordinates(order.customerLocation.coordinates),
            timestamp: order.customerLocation.timestamp || now
        };
    }
    
    return {
        id: order.id || generateId(),
        ref: order.ref || `WIZA${(order.id || generateId()).toString().padStart(4, '0')}`,
        items: order.items || [],
        itemsDetailed: order.itemsDetailed || order.items || [],
        subtotal: order.subtotal || 0,
        deliveryFee: order.deliveryFee || 0,
        serviceFee: order.serviceFee || 0,
        discount: order.discount || 0,
        total: order.total || 0,
        status: order.status || 'pending',
        date: order.date || now,
        delivery: order.delivery || { isDelivery: false },
        customerLocation: customerLocation,
        customer: order.customer || { 
            name: 'Unknown Customer', 
            email: '', 
            phone: '' 
        },
        promoCode: order.promoCode || null,
        paymentMethod: order.paymentMethod || 'Airtel Money',
        paymentDetails: order.paymentDetails || {},
        paymentScreenshot: order.paymentScreenshot || null,
        timestamp: order.timestamp || now,
        statusUpdated: order.statusUpdated || now,
        firebaseKey: order.firebaseKey,
        managerAccepted: order.managerAccepted || false,
        customerNotes: order.customerNotes || '',
        
        // Enhanced fields
        tracking: order.tracking || {
            received: order.date || now,
            preparing: null,
            ready: null,
            outForDelivery: null,
            completed: null,
            currentStatus: order.status || 'pending'
        },
        
        // Additional fields from Firebase
        orderType: order.orderType || 'delivery',
        preparationTime: order.preparationTime || 25,
        deliveryTime: order.deliveryTime || 15,
        totalPreparationTime: order.totalPreparationTime || 40,
        restaurantLocation: order.restaurantLocation || {
            latitude: restaurantLocation[0],
            longitude: restaurantLocation[1],
            address: "WIZA FOOD CAFE, Plot 123, Great East Road, Lusaka"
        },
        orderSource: order.orderSource || 'web_app',
        appVersion: order.appVersion || '2.1.0',
        deviceInfo: order.deviceInfo || {},
        notifications: order.notifications || {},
        metadata: order.metadata || {}
    };
}

// Normalize coordinates from different formats
function normalizeCoordinates(coordinates) {
    if (!coordinates) return null;
    
    if (Array.isArray(coordinates) && coordinates.length >= 2) {
        // Format: [lat, lng]
        return {
            latitude: coordinates[0],
            longitude: coordinates[1]
        };
    } else if (typeof coordinates === 'object') {
        // Format: { latitude: x, longitude: y } or { lat: x, lng: y }
        const lat = coordinates.latitude || coordinates.lat;
        const lng = coordinates.longitude || coordinates.lng || coordinates.lon;
        
        if (lat && lng) {
            return {
                latitude: parseFloat(lat),
                longitude: parseFloat(lng)
            };
        }
    }
    
    return null;
}

// Update existing order
function updateExistingOrder(updatedOrder) {
    try {
        const orderIndex = managerState.orders.findIndex(o => 
            o.id === updatedOrder.id || o.firebaseKey === updatedOrder.firebaseKey
        );
        
        if (orderIndex !== -1) {
            managerState.orders[orderIndex] = {
                ...managerState.orders[orderIndex],
                ...updatedOrder
            };
            
            saveManagerData();
            updateUIForOrderUpdate(updatedOrder);
            
            console.log(` Order ${updatedOrder.ref} updated in local state`);
        } else {
            // If order doesn't exist locally, add it
            console.log(' Order not found locally, adding:', updatedOrder.ref);
            processNewOrder(updatedOrder);
        }
    } catch (error) {
        console.error(' Error updating existing order:', error);
    }
}

// Update connection status in UI
function updateConnectionStatus(connected) {
    const statusElement = document.getElementById('connectionStatus');
    if (!statusElement) return;
    
    if (connected) {
        statusElement.innerHTML = '<i class="fas fa-wifi"></i><span>Connected</span>';
        statusElement.className = 'connection-status connected';
    } else {
        statusElement.innerHTML = '<i class="fas fa-wifi-slash"></i><span>Offline</span>';
        statusElement.className = 'connection-status disconnected';
    }
}

// Enhanced Notification System
// Enhanced Notification System with Sound
function showEnhancedNewOrderNotification(order) {
    managerState.currentNewOrder = order;
    
    // Play notification sound immediately
    if (managerState.soundEnabled && managerState.settings.notificationSound) {
        playNotificationSound();
    }
    
    // Show browser notification
    if ('Notification' in window && Notification.permission === 'granted') {
        const notification = new Notification(' New Order - WIZA FOOD CAFE', {
            body: `Order ${order.ref} from ${order.customer.name} - K${order.total.toFixed(2)}`,
            icon: 'wfc.png',
            badge: 'wfc.png',
            tag: order.firebaseKey,
            requireInteraction: true,
            vibrate: [200, 100, 200],
            data: {
                orderId: order.firebaseKey,
                customerName: order.customer.name,
                total: order.total
            },
            actions: [
                {
                    action: 'view',
                    title: ' View Order'
                },
                {
                    action: 'accept',
                    title: ' Accept'
                }
            ]
        });
        
        notification.onclick = function() {
            window.focus();
            viewOrderDetails(order.firebaseKey);
            notification.close();
            stopNotificationSound();
        };
        
        notification.onclose = function() {
            stopNotificationSound();
        };
    }
    
    // Show in-app notification
    showInAppOrderNotification(order);
    
    // Show popup notification
    showNewOrderPopup(order);
    
    // Update notification badge
    updatePendingOrdersCount();
}

// Enhanced Sound Notification with Fallback
function playNotificationSound() {
    try {
        // Stop any existing sound first
        stopNotificationSound();
        
        // Create audio element with your actual sound file
        managerState.notificationSound = new Audio('Notification.mp3');
        managerState.notificationSound.volume = 1.0;
        managerState.notificationSound.preload = 'auto';
        
        // Set up event listeners for better control
        managerState.notificationSound.addEventListener('canplaythrough', function() {
            console.log(' Notification sound ready to play');
        });
        
        managerState.notificationSound.addEventListener('error', function(e) {
            console.error(' Error loading notification sound:', e);
            playFallbackSound();
        });
        
        // Play sound repeatedly until stopped (with improved loop handling)
        let playCount = 0;
        const maxPlays = 5; // Limit to 5 plays to prevent infinite looping
        
        managerState.notificationSound.addEventListener('ended', function() {
            playCount++;
            if (playCount < maxPlays && managerState.soundEnabled) {
                this.currentTime = 0;
                this.play().catch(e => {
                    console.log('Audio play failed on loop:', e);
                });
            } else {
                stopNotificationSound();
            }
        });
        
        // Play the sound
        managerState.notificationSound.play().catch(e => {
            console.log('Audio play failed:', e);
            playFallbackSound();
        });
        
    } catch (error) {
        console.error('Error playing notification sound:', error);
        playFallbackSound();
    }
}

// Fallback sound using Web Audio API
function playFallbackSound() {
    try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = 800;
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(0.7, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 1);
        
    } catch (error) {
        console.error('Fallback sound also failed:', error);
    }
}

// Stop notification sound
function stopNotificationSound() {
    if (managerState.notificationSound) {
        managerState.notificationSound.pause();
        managerState.notificationSound.currentTime = 0;
        managerState.notificationSound = null;
    }
}

// Show status update notifications
function showStatusUpdateNotification(order) {
    if (managerState.settings.statusNotifications) {
        const statusMessages = {
            'preparing': `Order ${order.ref} is now being prepared`,
            'ready': `Order ${order.ref} is ready for pickup/delivery`,
            'out-for-delivery': `Order ${order.ref} is out for delivery`,
            'completed': `Order ${order.ref} has been completed`,
            'cancelled': `Order ${order.ref} has been cancelled`
        };
        
        const message = statusMessages[order.status];
        if (message) {
            showNotification(message, 'info');
            
            // Show browser notification for important status changes
            if (order.status === 'ready' || order.status === 'out-for-delivery') {
                if ('Notification' in window && Notification.permission === 'granted') {
                    new Notification(`Order ${order.status} - WIZA FOOD CAFE`, {
                        body: message,
                        icon: 'wfc.png',
                        tag: `status-${order.firebaseKey}`
                    });
                }
            }
        }
    }
}

// Show in-app order notification
function showInAppOrderNotification(order) {
    showNotification(`New order #${order.ref} from ${order.customer.name} - K${order.total.toFixed(2)}`, 'success');
}

// Show new order popup
function showNewOrderPopup(order) {
    const popup = elements.newOrderPopup;
    const orderId = document.getElementById('popupOrderId');
    const orderTotal = document.getElementById('popupOrderTotal');
    const customer = document.getElementById('popupCustomer');
    const items = document.getElementById('popupItems');
    
    if (popup && orderId && orderTotal && customer && items) {
        orderId.textContent = `Order #${order.ref}`;
        orderTotal.textContent = `K${order.total.toFixed(2)}`;
        customer.textContent = `Customer: ${order.customer.name}`;
        
        // Show first 3 items
        const itemsText = order.items.slice(0, 3).map(item => 
            `${item.quantity}x ${item.name}`
        ).join(', ');
        items.textContent = itemsText + (order.items.length > 3 ? `, +${order.items.length - 3} more` : '');
        
        showModal(popup);
        
        // Auto close after 10 seconds
        setTimeout(() => {
            if (popup.classList.contains('active')) {
                hideModal(popup);
                stopNotificationSound();
            }
        }, 10000);
    }
}

// Toggle sound on/off
function toggleSound() {
    managerState.soundEnabled = !managerState.soundEnabled;
    
    if (managerState.soundEnabled) {
        elements.soundToggle.innerHTML = '<i class="fas fa-volume-up"></i>';
        elements.soundToggle.classList.remove('muted');
        showNotification('Sound notifications enabled', 'success');
    } else {
        elements.soundToggle.innerHTML = '<i class="fas fa-volume-mute"></i>';
        elements.soundToggle.classList.add('muted');
        stopNotificationSound();
        showNotification('Sound notifications disabled', 'warning');
    }
}

// Start auto-refresh for orders
function startAutoRefresh() {
    // Refresh orders every 2 seconds for real-time updates
    setInterval(() => {
        if (managerState.currentSection === 'orders' || managerState.currentSection === 'dashboard') {
            updateDashboard();
            updatePendingOrdersCount();
        }
    }, 2000);
    
    // Check for new orders specifically every 3 seconds
    setInterval(() => {
        if (managerState.orders.length > 0) {
            const pendingOrders = managerState.orders.filter(order => order.status === 'pending');
            if (pendingOrders.length > 0) {
                updatePendingOrdersCount();
            }
        }
    }, 3000);
}

// Update UI when new order is received
function updateUIForNewOrder(order) {
    // Update dashboard if visible
    updateDashboard();
    
    // Update orders list if visible
    if (managerState.currentSection === 'orders') {
        loadOrders();
    }
    
    // Update pending orders count in navigation
    updatePendingOrdersCount();
    
    // Show visual indicator
    showNewOrderIndicator();
}

// Update UI when order is updated
function updateUIForOrderUpdate(order) {
    // Update dashboard
    updateDashboard();
    
    // Update orders list if visible
    if (managerState.currentSection === 'orders') {
        loadOrders();
    }
    
    // Update pending orders count
    updatePendingOrdersCount();
}

// Show new order indicator
function showNewOrderIndicator() {
    const indicator = document.createElement('div');
    indicator.id = 'newOrderIndicator';
    indicator.className = 'new-order-indicator';
    indicator.innerHTML = ' New Order!';
    document.body.appendChild(indicator);
    
    // Remove after 3 seconds
    setTimeout(() => {
        if (indicator.parentNode) {
            indicator.remove();
        }
    }, 3000);
}

// Manager accepts order
async function acceptOrder(orderId) {
    const order = managerState.orders.find(o => o.firebaseKey === orderId);
    if (order) {
        const oldStatus = order.status;
        order.status = 'preparing';
        order.statusUpdated = new Date().toISOString();
        order.managerAccepted = true;
        
        // Update tracking timestamps
        order.tracking = order.tracking || {};
        order.tracking.preparing = new Date().toISOString();
        order.tracking.currentStatus = 'preparing';
        
        try {
            if (order.firebaseKey) {
                const orderRef = db.ref(`orders/${order.firebaseKey}`);
                await orderRef.update({
                    status: 'preparing',
                    statusUpdated: order.statusUpdated,
                    managerAccepted: true,
                    tracking: order.tracking
                });
                console.log(` Order ${order.ref} accepted`);
                
                // Show success message
                showNotification(`Order ${order.ref} accepted!`, 'success');
                
                // Send notification to customer
                sendCustomerNotification(order, 'accepted');
            }
        } catch (error) {
            console.error(' Error updating order status in Firebase:', error);
            showNotification('Error updating order status in cloud', 'error');
        }
        
        saveManagerData();
        loadOrders();
        updateDashboard();
        stopNotificationSound(); // Stop sound when order is accepted
    }
}

// Manager rejects order
async function rejectOrder(orderId) {
    const order = managerState.orders.find(o => o.firebaseKey === orderId);
    if (order) {
        const oldStatus = order.status;
        order.status = 'cancelled';
        order.statusUpdated = new Date().toISOString();
        order.managerAccepted = false;
        
        // Update tracking timestamps
        order.tracking = order.tracking || {};
        order.tracking.cancelled = new Date().toISOString();
        order.tracking.currentStatus = 'cancelled';
        
        try {
            if (order.firebaseKey) {
                const orderRef = db.ref(`orders/${order.firebaseKey}`);
                await orderRef.update({
                    status: 'cancelled',
                    statusUpdated: order.statusUpdated,
                    managerAccepted: false,
                    tracking: order.tracking
                });
                console.log(` Order ${order.ref} rejected`);
                
                // Show success message
                showNotification(`Order ${order.ref} rejected!`, 'error');
                
                // Send notification to customer
                sendCustomerNotification(order, 'rejected');
            }
        } catch (error) {
            console.error(' Error updating order status in Firebase:', error);
            showNotification('Error updating order status in cloud', 'error');
        }
        
        saveManagerData();
        loadOrders();
        updateDashboard();
        stopNotificationSound(); // Stop sound when order is rejected
    }
}

// Send notification to customer
async function sendCustomerNotification(order, action) {
    try {
        // Create a notification in Firebase for the customer
        const notificationRef = db.ref(`notifications/${order.customer.phone}`);
        await notificationRef.push({
            orderId: order.id,
            orderRef: order.ref,
            action: action,
            message: action === 'accepted' 
                ? `Your order #${order.ref} has been accepted and is being prepared!`
                : `Your order #${order.ref} has been rejected. Please contact us for more information.`,
            timestamp: new Date().toISOString(),
            read: false
        });
        
        console.log(` Notification sent to customer for order ${order.ref}`);
    } catch (error) {
        console.error('Error sending customer notification:', error);
    }
}

// Accept current order in modal
function acceptCurrentOrder() {
    const orderId = elements.acceptOrderBtn.dataset.orderId;
    if (orderId) {
        acceptOrder(orderId);
        hideModal(elements.orderDetailsModal);
    }
}

// Reject current order in modal
function rejectCurrentOrder() {
    const orderId = elements.rejectOrderBtn.dataset.orderId;
    if (orderId) {
        if (confirm('Are you sure you want to reject this order?')) {
            rejectOrder(orderId);
            hideModal(elements.orderDetailsModal);
        }
    }
}

// Manager updates order status
async function updateOrderStatus(orderId, newStatus) {
    const order = managerState.orders.find(o => o.firebaseKey === orderId);
    if (order) {
        const oldStatus = order.status;
        order.status = newStatus;
        order.statusUpdated = new Date().toISOString();
        
        // Update tracking timestamps
        order.tracking = order.tracking || {};
        const now = new Date().toISOString();
        
        switch(newStatus) {
            case 'ready':
                order.tracking.ready = now;
                order.tracking.currentStatus = 'ready';
                break;
            case 'out-for-delivery':
                order.tracking.outForDelivery = now;
                order.tracking.currentStatus = 'out-for-delivery';
                break;
            case 'completed':
                order.tracking.completed = now;
                order.tracking.currentStatus = 'completed';
                break;
            case 'cancelled':
                order.tracking.cancelled = now;
                order.tracking.currentStatus = 'cancelled';
                stopNotificationSound(); // Stop sound when order is cancelled
                break;
        }
        
        try {
            if (order.firebaseKey) {
                const orderRef = db.ref(`orders/${order.firebaseKey}`);
                await orderRef.update({
                    status: newStatus,
                    statusUpdated: order.statusUpdated,
                    tracking: order.tracking
                });
                console.log(` Order ${order.ref} status updated to ${newStatus}`);
                
                showNotification(`Order ${order.ref} status updated to ${newStatus}`, 'success');
                
                // Send notification to customer
                sendCustomerNotification(order, newStatus);
            }
        } catch (error) {
            console.error(' Error updating order status in Firebase:', error);
            showNotification('Error updating order status in cloud', 'error');
        }
        
        saveManagerData();
        loadOrders();
        updateDashboard();
    }
}

// Load manager data from localStorage
function loadManagerData() {
    const savedData = localStorage.getItem('wizaManagerData');
    
    if (savedData) {
        try {
            const data = JSON.parse(savedData);
            Object.assign(managerState, data);
            
            // Initialize settings if not present
            if (!managerState.settings) {
                managerState.settings = {
                    appOnline: true,
                    acceptOrders: true,
                    deliveryEnabled: true,
                    notificationSound: true,
                    autoRefresh: true,
                    statusNotifications: true,
                    stockAlerts: true,
                    autoAcceptOrders: false,
                    autoPrint: false,
                    dailyReports: true,
                    customerInsights: true,
                    inventoryTracking: false,
                    preparationTime: 25
                };
            }
            
            // Initialize order counter if not present
            if (!managerState.orderCounter) {
                managerState.orderCounter = managerState.orders.length > 0 ? 
                    Math.max(...managerState.orders.map(o => o.id)) + 1 : 1;
            }
            
        } catch (e) {
            console.error('Error parsing saved data:', e);
            initializeDefaultData();
        }
    } else {
        initializeDefaultData();
    }
}

// Initialize default data
function initializeDefaultData() {
    managerState.menuItems = [...completeMenuData];
    managerState.orders = [];
    managerState.customers = [];
    managerState.promotions = [];
    managerState.settings = {
        appOnline: true,
        acceptOrders: true,
        deliveryEnabled: true,
        notificationSound: true,
        autoRefresh: true,
        statusNotifications: true,
        stockAlerts: true,
        autoAcceptOrders: false,
        autoPrint: false,
        dailyReports: true,
        customerInsights: true,
        inventoryTracking: false,
        preparationTime: 25
    };
    managerState.orderCounter = 1;

    saveManagerData();
}

// Save manager data to localStorage
function saveManagerData() {
    try {
        localStorage.setItem('wizaManagerData', JSON.stringify(managerState));
    } catch (error) {
        console.error('Error saving data:', error);
        showNotification('Error saving data. Storage might be full.', 'error');
    }
}

// Navigate to section
function navigateToSection(section) {
    // Update navigation
    elements.navItems.forEach(item => item.classList.remove('active'));
    const activeNavItem = document.querySelector(`[data-section="${section}"]`);
    if (activeNavItem) {
        activeNavItem.classList.add('active');
    }

    // Update content
    document.querySelectorAll('.content-section').forEach(contentSection => contentSection.classList.remove('active'));
    const activeSection = document.getElementById(section);
    if (activeSection) {
        activeSection.classList.add('active');
    }

    managerState.currentSection = section;

    // Refresh section data
    switch(section) {
        case 'dashboard':
            updateDashboard();
            break;
        case 'orders':
            loadOrders();
            break;
        case 'menu-management':
            loadFullMenu();
            break;
        case 'promotions':
            loadPromotions();
            break;
        case 'customers':
            loadCustomers();
            break;
        case 'analytics':
            initializeAnalytics();
            break;
    }
}

// Update dashboard
function updateDashboard() {
    const stats = calculateDashboardStats();
    
    // Update main stats
    if (elements.totalRevenue) elements.totalRevenue.textContent = `K${stats.totalRevenue.toFixed(2)}`;
    if (elements.totalOrders) elements.totalOrders.textContent = stats.totalOrders;
    if (elements.activeCustomers) elements.activeCustomers.textContent = stats.activeCustomers;
    if (elements.pendingOrders) elements.pendingOrders.textContent = stats.pendingOrders;
    if (elements.readyOrders) elements.readyOrders.textContent = stats.readyOrders;
    if (elements.pendingOrdersCount) elements.pendingOrdersCount.textContent = stats.pendingOrders;

    updateRecentOrders();
}

// Calculate dashboard stats
function calculateDashboardStats() {
    const today = new Date().toDateString();
    const todayOrders = managerState.orders.filter(order => 
        new Date(order.date).toDateString() === today
    );
    
    const totalRevenue = todayOrders.reduce((sum, order) => sum + order.total, 0);
    const totalOrders = todayOrders.length;
    const activeCustomers = managerState.customers.filter(c => c.status === 'active').length;
    const pendingOrders = managerState.orders.filter(o => o.status === 'pending').length;
    const readyOrders = managerState.orders.filter(o => o.status === 'ready').length;
    
    return {
        totalRevenue,
        totalOrders,
        activeCustomers,
        pendingOrders,
        readyOrders
    };
}

// Update recent orders
function updateRecentOrders() {
    if (!elements.recentOrdersList) return;

    const recentOrders = managerState.orders
        .sort((a, b) => new Date(b.date) - new Date(a.date))
        .slice(0, 5);

    if (recentOrders.length === 0) {
        return;
    }

    elements.recentOrdersList.innerHTML = recentOrders.map(order => `
        <div class="order-card" data-id="${order.firebaseKey}">
            <div class="order-header">
                <div class="order-info">
                    <h4>Order ${order.ref}</h4>
                    <p class="order-customer">${order.customer.name}</p>
                    <p class="order-time">${new Date(order.date).toLocaleString()}</p>
                </div>
                <div class="order-status-container">
                    <span class="order-status status-${order.status}">
                        <i class="fas fa-${getStatusIcon(order.status)}"></i> ${order.status}
                    </span>
                    <p class="order-total-amount">K${order.total.toFixed(2)}</p>
                </div>
            </div>
            <div class="order-actions">
                <button class="btn btn-primary view-order-btn" data-id="${order.firebaseKey}">
                    <i class="fas fa-eye"></i> View Details
                </button>
                ${order.status === 'pending' ? `
                    <button class="btn btn-success status-btn" data-id="${order.firebaseKey}" data-status="preparing" onclick="acceptOrder('${order.firebaseKey}')">
                        <i class="fas fa-check"></i> Accept Order
                    </button>
                ` : ''}
            </div>
        </div>
    `).join('');
}

// Update pending orders count
function updatePendingOrdersCount() {
    const pendingCount = managerState.orders.filter(order => order.status === 'pending').length;
    if (elements.pendingOrdersCount) {
        elements.pendingOrdersCount.textContent = pendingCount;
    }
}

// Load orders
function loadOrders() {
    if (!elements.ordersList) return;

    const searchQuery = elements.orderSearch ? elements.orderSearch.value.toLowerCase() : '';
    
    let filteredOrders = managerState.orders;

    if (searchQuery) {
        filteredOrders = filteredOrders.filter(order => 
            order.ref.toLowerCase().includes(searchQuery) ||
            order.customer.name.toLowerCase().includes(searchQuery) ||
            order.customer.phone.includes(searchQuery)
        );
    }

    filteredOrders.sort((a, b) => new Date(b.date) - new Date(a.date));

    if (filteredOrders.length === 0) {
        elements.ordersList.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-shopping-cart"></i>
                <h3>No Orders Found</h3>
                <p>${!searchQuery ? 'No orders have been placed yet.' : 'No orders match your search.'}</p>
            </div>
        `;
        return;
    }

    elements.ordersList.innerHTML = filteredOrders.map(order => `
        <div class="order-card ${order.status === 'pending' ? 'new' : ''}" data-id="${order.firebaseKey}">
            <div class="order-header">
                <div class="order-info">
                    <h4>Order ${order.ref}</h4>
                    <p class="order-customer">
                        <i class="fas fa-user"></i> ${order.customer.name}  
                        <i class="fas fa-phone"></i> ${order.customer.phone}
                    </p>
                    <p class="order-time">
                        <i class="fas fa-clock"></i> ${new Date(order.date).toLocaleString()}
                    </p>
                </div>
                <div class="order-status-container">
                    <span class="order-status status-${order.status}">
                        <i class="fas fa-${getStatusIcon(order.status)}"></i> ${order.status}
                    </span>
                    <p class="order-total-amount">K${order.total.toFixed(2)}</p>
                </div>
            </div>
            
            <div class="order-items-preview">
                ${order.items.slice(0, 2).map(item => `
                    <div class="order-item-preview">
                        <div class="item-preview-image"></div>
                        <span>${item.quantity}x ${item.name}</span>
                    </div>
                `).join('')}
                ${order.items.length > 2 ? `<div class="more-items">+${order.items.length - 2} more items</div>` : ''}
            </div>

            <div class="order-actions">
                <button class="btn btn-primary view-order-btn" data-id="${order.firebaseKey}">
                    <i class="fas fa-eye"></i> View Details
                </button>
                
                ${getStatusButtons(order)}
            </div>
        </div>
    `).join('');
}

// Get status buttons based on order status
function getStatusButtons(order) {
    const status = order.status;
    let buttons = '';
    
    switch(status) {
        case 'pending':
            buttons = `
                <button class="btn btn-success status-btn" data-id="${order.firebaseKey}" data-status="preparing" onclick="acceptOrder('${order.firebaseKey}')">
                    <i class="fas fa-check"></i> Accept Order
                </button>
                <button class="btn btn-danger status-btn" data-id="${order.firebaseKey}" data-status="cancelled" onclick="rejectOrder('${order.firebaseKey}')">
                    <i class="fas fa-times"></i> Reject
                </button>
            `;
            break;
            
        case 'preparing':
            buttons = `
                <button class="btn btn-warning status-btn" data-id="${order.firebaseKey}" data-status="ready">
                    <i class="fas fa-check-double"></i> Mark Ready
                </button>
            `;
            break;
            
        case 'ready':
            if (order.delivery.isDelivery) {
                buttons = `
                    <button class="btn btn-info status-btn" data-id="${order.firebaseKey}" data-status="out-for-delivery">
                        <i class="fas fa-truck"></i> Out for Delivery
                    </button>
                `;
            } else {
                buttons = `
                    <button class="btn btn-success status-btn" data-id="${order.firebaseKey}" data-status="completed">
                        <i class="fas fa-check-circle"></i> Complete
                    </button>
                `;
            }
            break;
            
        case 'out-for-delivery':
            buttons = `
                <button class="btn btn-success status-btn" data-id="${order.firebaseKey}" data-status="completed">
                    <i class="fas fa-check-circle"></i> Delivered
                </button>
            `;
            break;
    }
    
    return buttons;
}

// Get status icon
function getStatusIcon(status) {
    const icons = {
        'pending': 'clock',
        'preparing': 'utensils',
        'ready': 'check-circle',
        'out-for-delivery': 'truck',
        'completed': 'check-double',
        'cancelled': 'times-circle'
    };
    return icons[status] || 'question';
}

// Filter orders
function filterOrders() {
    loadOrders();
}

// Enhanced Order Details with Better Map
function viewOrderDetails(orderId) {
    const order = managerState.orders.find(o => o.firebaseKey === orderId);
    if (!order) return;

    if (!elements.orderDetailsModal) return;
    
    // Store current order for modal actions
    managerState.currentOrderInModal = order;
    
    const modalContent = elements.orderDetailsContent;
    modalContent.innerHTML = `
        <div class="order-detail-section">
            <h4><i class="fas fa-info-circle"></i> Order Information</h4>
            <div class="detail-grid">
                <div class="detail-item">
                    <label><i class="fas fa-hashtag"></i> Order Reference:</label>
                    <span>${order.ref}</span>
                </div>
                <div class="detail-item">
                    <label><i class="fas fa-calendar"></i> Order Date:</label>
                    <span>${new Date(order.date).toLocaleString()}</span>
                </div>
                <div class="detail-item">
                    <label><i class="fas fa-flag"></i> Status:</label>
                    <span class="order-status status-${order.status}">${order.status}</span>
                </div>
                <div class="detail-item">
                    <label><i class="fas fa-shipping-fast"></i> Delivery Method:</label>
                    <span>${order.delivery.isDelivery ? 'Delivery' : 'Self Pickup'}</span>
                </div>
                ${order.orderType ? `
                <div class="detail-item">
                    <label><i class="fas fa-tag"></i> Order Type:</label>
                    <span>${order.orderType}</span>
                </div>
                ` : ''}
                ${order.totalPreparationTime ? `
                <div class="detail-item">
                    <label><i class="fas fa-clock"></i> Estimated Time:</label>
                    <span>${order.totalPreparationTime} minutes</span>
                </div>
                ` : ''}
            </div>
        </div>

        <div class="order-detail-section">
            <h4><i class="fas fa-user"></i> Customer Information</h4>
            <div class="detail-grid">
                <div class="detail-item">
                    <label><i class="fas fa-user"></i> Name:</label>
                    <span>${order.customer.name}</span>
                </div>
                <div class="detail-item">
                    <label><i class="fas fa-phone"></i> Phone:</label>
                    <span>${order.customer.phone}</span>
                </div>
                ${order.customer.email ? `
                <div class="detail-item">
                    <label><i class="fas fa-envelope"></i> Email:</label>
                    <span>${order.customer.email}</span>
                </div>
                ` : ''}
                ${order.customer.userId ? `
                <div class="detail-item">
                    <label><i class="fas fa-id-card"></i> User ID:</label>
                    <span>${order.customer.userId}</span>
                </div>
                ` : ''}
            </div>
        </div>

        <div class="order-detail-section">
            <h4><i class="fas fa-utensils"></i> Order Items</h4>
            <div class="order-items-detailed">
                ${(order.itemsDetailed || order.items).map(item => `
                    <div class="order-item-detailed">
                        <div class="item-image">
                            <img src="${item.image || 'default-food.jpg'}" alt="${item.name}" style="width: 60px; height: 60px; object-fit: cover; border-radius: var(--border-radius);">
                        </div>
                        <div class="item-details">
                            <h5>${item.name}</h5>
                            <p class="item-price">K${item.price}  ${item.quantity} = K${(item.price * item.quantity).toFixed(2)}</p>
                            ${item.description ? `<p class="item-description">${item.description}</p>` : ''}
                            ${(item.toppings && item.toppings.length > 0) || item.instructions ? `
                                <div class="customization-list">
                                    ${item.toppings && item.toppings.length > 0 ? `
                                        <div class="customization-item">
                                            <strong>Toppings:</strong> ${item.toppings.join(', ')}
                                        </div>
                                    ` : ''}
                                    ${item.instructions ? `
                                        <div class="customization-item">
                                            <strong>Special Instructions:</strong> ${item.instructions}
                                        </div>
                                    ` : ''}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>

        ${order.delivery.isDelivery && order.customerLocation ? `
        <div class="order-detail-section">
            <h4><i class="fas fa-map-marker-alt"></i> Customer Location</h4>
            ${formatCoordinates(order)}
            ${order.customerLocation.coordinates ? `
            <div class="map-container" id="deliveryMap"></div>
            <div class="navigation-buttons">
                <a href="https://waze.com/ul?ll=${order.customerLocation.coordinates.latitude},${order.customerLocation.coordinates.longitude}&navigate=yes" target="_blank" class="nav-btn waze">
                    <i class="fab fa-waze"></i> Navigate with Waze
                </a>
                <a href="https://www.google.com/maps/dir/?api=1&destination=${order.customerLocation.coordinates.latitude},${order.customerLocation.coordinates.longitude}" target="_blank" class="nav-btn google">
                    <i class="fab fa-google"></i> Navigate with Google Maps
                </a>
            </div>
            ` : ''}
        </div>
        ` : ''}

        <div class="order-detail-section">
            <h4><i class="fas fa-money-bill-wave"></i> Payment Information</h4>
            <div class="detail-grid">
                <div class="detail-item">
                    <label>Subtotal:</label>
                    <span>K${order.subtotal.toFixed(2)}</span>
                </div>
                ${order.delivery.isDelivery ? `
                <div class="detail-item">
                    <label>Delivery Fee:</label>
                    <span>K${order.deliveryFee.toFixed(2)}</span>
                </div>
                ` : ''}
                <div class="detail-item">
                    <label>Service Fee:</label>
                    <span>K${order.serviceFee.toFixed(2)}</span>
                </div>
                ${order.discount > 0 ? `
                <div class="detail-item discount">
                    <label>Discount (${order.promoCode ? order.promoCode.code || order.promoCode : 'Promo'}):</label>
                    <span>-K${order.discount.toFixed(2)}</span>
                </div>
                ` : ''}
                <div class="detail-item total">
                    <label>Total Amount:</label>
                    <span>K${order.total.toFixed(2)}</span>
                </div>
                <div class="detail-item">
                    <label>Payment Method:</label>
                    <span>${order.paymentMethod}</span>
                </div>
                ${order.paymentDetails && order.paymentDetails.transactionId ? `
                <div class="detail-item">
                    <label>Transaction ID:</label>
                    <span>${order.paymentDetails.transactionId}</span>
                </div>
                ` : ''}
                ${order.paymentDetails && order.paymentDetails.phoneNumber ? `
                <div class="detail-item">
                    <label>Payment Phone:</label>
                    <span>${order.paymentDetails.phoneNumber}</span>
                </div>
                ` : ''}
            </div>
            ${order.paymentScreenshot && order.paymentScreenshot.url ? `
            <div style="margin-top: var(--spacing-md);">
                <label>Payment Screenshot:</label>
                <img src="${order.paymentScreenshot.url}" alt="Payment Screenshot" class="payment-screenshot">
            </div>
            ` : ''}
        </div>

        ${order.customerNotes ? `
        <div class="customer-notes">
            <div class="notes-label">Customer Notes:</div>
            <div class="notes-content">${order.customerNotes}</div>
        </div>
        ` : ''}

        <div class="order-detail-section">
            <h4><i class="fas fa-history"></i> Order Timeline</h4>
            <div class="order-timeline">
                <div class="timeline-item">
                    <div class="timeline-dot ${order.tracking.received ? 'active' : ''}"></div>
                    <div class="timeline-content">
                        <div>Order Received</div>
                        <div class="timeline-time">${order.tracking.received ? new Date(order.tracking.received).toLocaleString() : 'Pending'}</div>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-dot ${order.tracking.preparing ? 'active' : ''}"></div>
                    <div class="timeline-content">
                        <div>Preparing</div>
                        <div class="timeline-time">${order.tracking.preparing ? new Date(order.tracking.preparing).toLocaleString() : 'Pending'}</div>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-dot ${order.tracking.ready ? 'active' : ''}"></div>
                    <div class="timeline-content">
                        <div>Ready</div>
                        <div class="timeline-time">${order.tracking.ready ? new Date(order.tracking.ready).toLocaleString() : 'Pending'}</div>
                    </div>
                </div>
                ${order.delivery.isDelivery ? `
                <div class="timeline-item">
                    <div class="timeline-dot ${order.tracking.outForDelivery ? 'active' : ''}"></div>
                    <div class="timeline-content">
                        <div>Out for Delivery</div>
                        <div class="timeline-time">${order.tracking.outForDelivery ? new Date(order.tracking.outForDelivery).toLocaleString() : 'Pending'}</div>
                    </div>
                </div>
                ` : ''}
                <div class="timeline-item">
                    <div class="timeline-dot ${order.tracking.completed ? 'active' : ''}"></div>
                    <div class="timeline-content">
                        <div>Completed</div>
                        <div class="timeline-time">${order.tracking.completed ? new Date(order.tracking.completed).toLocaleString() : 'Pending'}</div>
                    </div>
                </div>
            </div>
        </div>
    `;

    // Set the order ID for the accept and reject buttons
    if (elements.acceptOrderBtn) {
        elements.acceptOrderBtn.dataset.orderId = order.firebaseKey;
        // Show/hide accept button based on order status
        if (order.status === 'pending') {
            elements.acceptOrderBtn.style.display = 'flex';
        } else {
            elements.acceptOrderBtn.style.display = 'none';
        }
    }

    if (elements.rejectOrderBtn) {
        elements.rejectOrderBtn.dataset.orderId = order.firebaseKey;
        // Show/hide reject button based on order status
        if (order.status === 'pending') {
            elements.rejectOrderBtn.style.display = 'flex';
        } else {
            elements.rejectOrderBtn.style.display = 'none';
        }
    }

    // Initialize map if customer location exists
    if (order.delivery.isDelivery && order.customerLocation && order.customerLocation.coordinates) {
        setTimeout(() => {
            initializeDeliveryMap(order);
        }, 100);
    }

    showModal(elements.orderDetailsModal);
}

// Enhanced Delivery Map Initialization
function initializeDeliveryMap(order) {
    const mapContainer = document.getElementById('deliveryMap');
    if (!mapContainer) return;
    
    try {
        const customerCoords = order.customerLocation?.coordinates;
        if (!customerCoords) {
            mapContainer.innerHTML = '<p>No customer location available</p>';
            return;
        }
        
        const customerLat = customerCoords.latitude || customerCoords[0];
        const customerLng = customerCoords.longitude || customerCoords[1];
        
        if (!customerLat || !customerLng) {
            mapContainer.innerHTML = '<p>Invalid coordinates</p>';
            return;
        }
        
        const map = L.map('deliveryMap').setView([customerLat, customerLng], 15);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: ' OpenStreetMap contributors'
        }).addTo(map);
        
        // Restaurant marker
        L.marker(managerState.restaurantLocation)
            .addTo(map)
            .bindPopup(' WIZA FOOD CAFE')
            .openPopup();
        
        // Customer marker
        L.marker([customerLat, customerLng])
            .addTo(map)
            .bindPopup(' Customer Location')
            .openPopup();
        
        // Route line
        L.polyline([
            managerState.restaurantLocation,
            [customerLat, customerLng]
        ], {
            color: 'orange',
            weight: 4,
            opacity: 0.7
        }).addTo(map);
        
    } catch (error) {
        console.error(' Error initializing map:', error);
        mapContainer.innerHTML = '<p>Error loading map</p>';
    }
}

// Print order details
function printOrderDetails() {
    window.print();
}

// Load full menu
function loadFullMenu(category = 'all') {
    if (!elements.menuItemsGrid) return;

    let filteredItems = managerState.menuItems;

    if (category !== 'all') {
        filteredItems = filteredItems.filter(item => item.category === category);
    }

    if (filteredItems.length === 0) {
        elements.menuItemsGrid.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-utensils"></i>
                <h3>No Menu Items</h3>
                <p>${category === 'all' ? 'No menu items found.' : `No items in ${category} category.`}</p>
            </div>
        `;
        return;
    }

    elements.menuItemsGrid.innerHTML = filteredItems.map(item => `
        <div class="menu-item-card">
            <div class="menu-item-image">
                <img src="${item.image}" alt="${item.name}">
                ${item.popular ? '<span class="popular-badge">Popular</span>' : ''}
                ${item.new ? '<span class="new-badge">New</span>' : ''}
                ${!item.available ? '<div class="unavailable-overlay">Unavailable</div>' : ''}
            </div>
            <div class="menu-item-info">
                <h4 class="item-name">${item.name}</h4>
                <p class="item-description">${item.description}</p>
                <div class="item-meta">
                    <span class="item-category">${formatCategory(item.category)}</span>
                    ${item.vegetarian ? '<span class="vegetarian-badge">Vegetarian</span>' : ''}
                </div>
                <div class="item-pricing">
                    ${item.originalPrice ? `
                        <span class="original-price">K${item.originalPrice.toFixed(2)}</span>
                    ` : ''}
                    <span class="current-price">K${item.price.toFixed(2)}</span>
                    ${item.discount ? `
                        <span class="discount-badge">${item.discount}% OFF</span>
                    ` : ''}
                </div>
            </div>
            <div class="menu-item-actions">
                <button class="btn btn-primary">
                    <i class="fas fa-edit"></i> Edit
                </button>
                <button class="btn btn-secondary">
                    <i class="fas fa-eye"></i> View
                </button>
            </div>
        </div>
    `).join('');
}

// Search menu items
function searchMenuItems() {
    const query = elements.menuSearch.value.toLowerCase().trim();
    
    if (query.length < 2) {
        loadFullMenu();
        return;
    }
    
    const filteredItems = managerState.menuItems.filter(item => 
        item.name.toLowerCase().includes(query) ||
        item.description.toLowerCase().includes(query) ||
        item.category.toLowerCase().includes(query)
    );
    
    displaySearchResults(filteredItems, query);
}

// Display search results
function displaySearchResults(items, query) {
    if (!elements.menuItemsGrid) return;

    if (items.length === 0) {
        elements.menuItemsGrid.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-search"></i>
                <h3>No Results Found</h3>
                <p>No menu items found for "${query}"</p>
            </div>
        `;
        return;
    }

    elements.menuItemsGrid.innerHTML = items.map(item => `
        <div class="menu-item-card">
            <div class="menu-item-image">
                <img src="${item.image}" alt="${item.name}">
            </div>
            <div class="menu-item-info">
                <h4 class="item-name">${highlightText(item.name, query)}</h4>
                <p class="item-description">${highlightText(item.description, query)}</p>
                <div class="item-pricing">
                    <span class="current-price">K${item.price.toFixed(2)}</span>
                </div>
            </div>
        </div>
    `).join('');
}

// Handle add menu item
function handleAddMenuItem(e) {
    e.preventDefault();
    
    const itemName = document.getElementById('itemName').value;
    const itemDescription = document.getElementById('itemDescription').value;
    const itemPrice = parseFloat(document.getElementById('itemPrice').value);
    const itemCategory = document.getElementById('itemCategory').value;
    
    const newItem = {
        id: generateId(),
        name: itemName,
        description: itemDescription,
        price: itemPrice,
        category: itemCategory,
        available: true,
        image: 'default-food.jpg'
    };
    
    managerState.menuItems.push(newItem);
    saveManagerData();
    loadFullMenu();
    hideModal(elements.menuItemModal);
    showNotification('Menu item added successfully!', 'success');
}

// Load customers
function loadCustomers() {
    // Extract customers from orders
    const customerMap = new Map();
    
    managerState.orders.forEach(order => {
        if (order.customer && order.customer.phone) {
            const key = order.customer.phone;
            if (!customerMap.has(key)) {
                customerMap.set(key, {
                    ...order.customer,
                    orderCount: 0,
                    totalSpent: 0,
                    lastOrder: order.date,
                    status: 'active'
                });
            }
            
            const customer = customerMap.get(key);
            customer.orderCount++;
            customer.totalSpent += order.total;
            
            if (new Date(order.date) > new Date(customer.lastOrder)) {
                customer.lastOrder = order.date;
            }
        }
    });

    managerState.customers = Array.from(customerMap.values());
    
    // Update UI
    updateCustomersTable();
}

// Update customers table
function updateCustomersTable() {
    if (!elements.customersTableBody || !elements.customersEmptyState) return;
    
    if (managerState.customers.length === 0) {
        elements.customersTableBody.innerHTML = '';
        elements.customersEmptyState.style.display = 'block';
        return;
    }
    
    elements.customersEmptyState.style.display = 'none';
    
    elements.customersTableBody.innerHTML = managerState.customers.map(customer => `
        <tr>
            <td>${customer.name}</td>
            <td>${customer.phone}</td>
            <td>${customer.email || 'N/A'}</td>
            <td>${customer.orderCount}</td>
            <td>K${customer.totalSpent.toFixed(2)}</td>
            <td>${new Date(customer.lastOrder).toLocaleDateString()}</td>
            <td>
                <span class="customer-status status-${customer.status}">
                    ${customer.status === 'active' ? 'Active' : 'Inactive'}
                </span>
            </td>
        </tr>
    `).join('');
}

// Search customers
function searchCustomers() {
    const query = elements.customerSearch.value.toLowerCase().trim();
    
    if (query.length < 2) {
        updateCustomersTable();
        return;
    }
    
    const filteredCustomers = managerState.customers.filter(customer => 
        customer.name.toLowerCase().includes(query) ||
        customer.email.toLowerCase().includes(query) ||
        customer.phone.includes(query)
    );
    
    if (filteredCustomers.length === 0) {
        elements.customersTableBody.innerHTML = '';
        elements.customersEmptyState.style.display = 'block';
        elements.customersEmptyState.innerHTML = `
            <i class="fas fa-search"></i>
            <h3>No Customers Found</h3>
            <p>No customers match your search for "${query}"</p>
        `;
        return;
    }
    
    elements.customersEmptyState.style.display = 'none';
    
    elements.customersTableBody.innerHTML = filteredCustomers.map(customer => `
        <tr>
            <td>${customer.name}</td>
            <td>${customer.phone}</td>
            <td>${customer.email || 'N/A'}</td>
            <td>${customer.orderCount}</td>
            <td>K${customer.totalSpent.toFixed(2)}</td>
            <td>${new Date(customer.lastOrder).toLocaleDateString()}</td>
            <td>
                <span class="customer-status status-${customer.status}">
                    ${customer.status === 'active' ? 'Active' : 'Inactive'}
                </span>
            </td>
        </tr>
    `).join('');
}

// Load promotions
function loadPromotions() {
    if (!elements.promotionsGrid) return;

    if (managerState.promotions.length === 0) {
        elements.promotionsGrid.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-tag"></i>
                <h3>No Promotions</h3>
                <p>No active promotions found. Create your first promotion to attract more customers!</p>
            </div>
        `;
        return;
    }

    elements.promotionsGrid.innerHTML = managerState.promotions.map(promo => `
        <div class="promotion-card">
            <div class="promotion-header">
                <h4>${promo.title}</h4>
                <span class="promotion-status ${promo.active ? 'active' : 'inactive'}">
                    ${promo.active ? 'Active' : 'Inactive'}
                </span>
            </div>
            <div class="promotion-body">
                <p class="promotion-description">${promo.description}</p>
                <div class="promotion-details">
                    <div class="detail">
                        <span class="label">Code:</span>
                        <span class="value">${promo.code}</span>
                    </div>
                    <div class="detail">
                        <span class="label">Discount:</span>
                        <span class="value">${promo.discount}%</span>
                    </div>
                </div>
            </div>
        </div>
    `).join('');
}

// Handle add promotion
function handleAddPromotion(e) {
    e.preventDefault();
    
    const title = document.getElementById('promotionTitle').value;
    const description = document.getElementById('promotionDescription').value;
    const code = document.getElementById('promotionCode').value;
    const discount = parseInt(document.getElementById('promotionDiscount').value);
    const start = document.getElementById('promotionStart').value;
    const end = document.getElementById('promotionEnd').value;
    
    const newPromotion = {
        id: generateId(),
        title: title,
        description: description,
        code: code,
        discount: discount,
        startDate: start,
        endDate: end,
        active: true
    };
    
    managerState.promotions.push(newPromotion);
    saveManagerData();
    loadPromotions();
    hideModal(elements.promotionModal);
    showNotification('Promotion created successfully!', 'success');
}

// Initialize analytics
function initializeAnalytics() {
    // This would initialize charts with real data
    // For now, we'll show placeholder charts
    setTimeout(() => {
        initializeCharts();
    }, 100);
}

// Initialize charts
function initializeCharts() {
    // Revenue Chart
    if (elements.revenueChart) {
        const revenueCtx = elements.revenueChart.getContext('2d');
        new Chart(revenueCtx, {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Revenue (K)',
                    data: [1200, 1900, 1500, 2000, 1800, 2500, 2200],
                    borderColor: '#CC5500',
                    backgroundColor: 'rgba(204, 85, 0, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#CCCCCC'
                        }
                    },
                    x: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#CCCCCC'
                        }
                    }
                }
            }
        });
    }

    // Orders Chart
    if (elements.ordersChart) {
        const ordersCtx = elements.ordersChart.getContext('2d');
        new Chart(ordersCtx, {
            type: 'bar',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Orders',
                    data: [25, 32, 28, 35, 30, 45, 38],
                    backgroundColor: '#E67E22',
                    borderColor: '#CC5500',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#CCCCCC'
                        }
                    },
                    x: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#CCCCCC'
                        }
                    }
                }
            }
        });
    }
}

// Load settings
function loadSettings() {
    if (!elements.notificationSound) return;
    
    // Load settings from managerState
    elements.notificationSound.checked = managerState.settings.notificationSound;
    elements.statusNotifications.checked = managerState.settings.statusNotifications;
    elements.stockAlerts.checked = managerState.settings.stockAlerts;
    elements.acceptOrders.checked = managerState.settings.acceptOrders;
    elements.deliveryEnabled.checked = managerState.settings.deliveryEnabled;
    elements.autoRefresh.checked = managerState.settings.autoRefresh;
    elements.preparationTime.value = managerState.settings.preparationTime;
    elements.autoAcceptOrders.checked = managerState.settings.autoAcceptOrders;
    elements.autoPrint.checked = managerState.settings.autoPrint;
    elements.dailyReports.checked = managerState.settings.dailyReports;
    elements.customerInsights.checked = managerState.settings.customerInsights;
    elements.inventoryTracking.checked = managerState.settings.inventoryTracking;
}

// Save settings
function saveSettings() {
    managerState.settings.notificationSound = elements.notificationSound.checked;
    managerState.settings.statusNotifications = elements.statusNotifications.checked;
    managerState.settings.stockAlerts = elements.stockAlerts.checked;
    managerState.settings.acceptOrders = elements.acceptOrders.checked;
    managerState.settings.deliveryEnabled = elements.deliveryEnabled.checked;
    managerState.settings.autoRefresh = elements.autoRefresh.checked;
    managerState.settings.preparationTime = parseInt(elements.preparationTime.value);
    managerState.settings.autoAcceptOrders = elements.autoAcceptOrders.checked;
    managerState.settings.autoPrint = elements.autoPrint.checked;
    managerState.settings.dailyReports = elements.dailyReports.checked;
    managerState.settings.customerInsights = elements.customerInsights.checked;
    managerState.settings.inventoryTracking = elements.inventoryTracking.checked;
    
    saveManagerData();
    showNotification('Settings saved successfully!', 'success');
}

// Show modal
function showModal(modal) {
    if (!modal) return;
    
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
}

// Hide modal
function hideModal(modal) {
    if (!modal) return;
    
    modal.classList.remove('active');
    document.body.style.overflow = 'auto';
}

// Close all modals
function closeAllModals() {
    elements.modals.forEach(modal => hideModal(modal));
}

// Show notification
function showNotification(message, type = 'info') {
    const notification = elements.notification;
    const messageEl = document.getElementById('notificationMessage');
    
    if (!notification || !messageEl) return;
    
    messageEl.textContent = message;
    notification.className = `notification notification-${type} show`;
    
    // Auto remove after 5 seconds
    setTimeout(() => {
        notification.classList.remove('show');
    }, 5000);
}

// Logout
function logout() {
    if (confirm('Are you sure you want to logout?')) {
        // Redirect to main site
        window.location.href = 'https://bufferzone-cloud.github.io/wizafoodcafe/';
    }
}

// Utility functions
function generateId() {
    const allIds = [
        ...managerState.menuItems.map(item => item.id),
        ...managerState.orders.map(order => order.id),
        ...managerState.customers.map(customer => customer.id),
        ...managerState.promotions.map(promo => promo.id)
    ];
    return allIds.length > 0 ? Math.max(...allIds) + 1 : 1;
}

function formatCategory(category) {
    return category.split('-').map(word => 
        word.charAt(0).toUpperCase() + word.slice(1)
    ).join(' ');
}

function highlightText(text, query) {
    if (!query) return text;
    const regex = new RegExp(`(${query})`, 'gi');
    return text.replace(regex, '<mark>$1</mark>');
}

function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Sample menu data
const completeMenuData = [
    {
        id: 1,
        name: "Chicken & Chips (Wing)",
        description: "Crispy chicken wings served with golden fries",
        price: 35,
        originalPrice: 40,
        category: "quick-fills",
        image: "Q1.jpg",
        available: true,
        popular: true,
        vegetarian: false,
        discount: 12
    },
    {
        id: 2,
        name: "Sausage & Chips",
        description: "Grilled sausage served with crispy chips",
        price: 40,
        category: "quick-fills",
        image: "Q2.jpg",
        available: true,
        popular: true,
        vegetarian: false
    },
    {
        id: 3,
        name: "Chicken Drumsticks",
        description: "Juicy, flavorful chicken drumsticks",
        price: 45,
        category: "quick-fills",
        image: "Q3.jpg",
        available: true,
        popular: true,
        new: true,
        vegetarian: false
    },
    {
        id: 4,
        name: "Plain Chips",
        description: "Crispy golden fries with a pinch of salt",
        price: 20,
        category: "quick-fills",
        image: "Q4.jpg",
        available: true,
        vegetarian: true
    },
    {
        id: 5,
        name: "Beef Burger",
        description: "Juicy beef patty with fresh vegetables",
        price: 45,
        category: "savory-bites",
        image: "S1.jpg",
        available: true,
        popular: true,
        vegetarian: false
    },
    {
        id: 6,
        name: "Vegetable Pizza",
        description: "Fresh vegetables on a crispy crust",
        price: 55,
        category: "savory-bites",
        image: "S2.jpg",
        available: true,
        vegetarian: true
    },
    {
        id: 7,
        name: "Chicken Pizza",
        description: "Tender chicken pieces on cheesy pizza",
        price: 60,
        category: "savory-bites",
        image: "S3.jpg",
        available: true,
        popular: true,
        vegetarian: false
    },
    {
        id: 8,
        name: "Beef Pie",
        description: "Flaky pastry filled with seasoned beef",
        price: 25,
        category: "savory-bites",
        image: "S4.jpg",
        available: true,
        vegetarian: false
    },
    {
        id: 9,
        name: "Samosa (2pcs)",
        description: "Crispy pastry filled with spiced potatoes",
        price: 15,
        category: "snacks-treats",
        image: "ST1.jpg",
        available: true,
        popular: true,
        vegetarian: true
    },
    {
        id: 10,
        name: "Spring Rolls (3pcs)",
        description: "Crispy rolls with vegetable filling",
        price: 20,
        category: "snacks-treats",
        image: "ST2.jpg",
        available: true,
        vegetarian: true
    },
    {
        id: 11,
        name: "Cream Doughnut",
        description: "Soft doughnut filled with sweet cream",
        price: 12,
        category: "snacks-treats",
        image: "ST3.jpg",
        available: true,
        vegetarian: true
    },
    {
        id: 12,
        name: "Chocolate Muffin",
        description: "Rich chocolate muffin with soft center",
        price: 15,
        category: "snacks-treats",
        image: "ST4.jpg",
        available: true,
        new: true,
        vegetarian: true
    },
    {
        id: 13,
        name: "Coca Cola (500ml)",
        description: "Classic cola soft drink",
        price: 15,
        category: "beverages",
        image: "B1.jpg",
        available: true,
        popular: true,
        vegetarian: true
    },
    {
        id: 14,
        name: "Fanta (500ml)",
        description: "Refreshing orange flavored drink",
        price: 15,
        category: "beverages",
        image: "B2.jpg",
        available: true,
        vegetarian: true
    },
    {
        id: 15,
        name: "Sprite (500ml)",
        description: "Crisp lemon-lime flavored soda",
        price: 15,
        category: "beverages",
        image: "B3.jpg",
        available: true,
        vegetarian: true
    },
    {
        id: 16,
        name: "Bottled Water (500ml)",
        description: "Pure drinking water",
        price: 8,
        category: "beverages",
        image: "B4.jpg",
        available: true,
        vegetarian: true
    }
];

// Initialize the enhanced app when DOM is loaded
document.addEventListener('DOMContentLoaded', initializeManagerApp);

// Make functions globally available
window.acceptOrder = acceptOrder;
window.rejectOrder = rejectOrder;
window.updateOrderStatus = updateOrderStatus;
window.navigateToSection = navigateToSection;
window.printOrderDetails = printOrderDetails;
window.formatCoordinates = formatCoordinates;
window.initializeDeliveryMap = initializeDeliveryMap;
    </script>
</body>
</html>





